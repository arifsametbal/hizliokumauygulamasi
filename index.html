<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hƒ±zlƒ± Okuma - Akƒ±llƒ± √ñƒürenci Takip Sistemi</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Prop Types -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>

    <!-- Recharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.min.js"></script>
    
    <!-- Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; margin: 0; padding: 0; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .animate-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; font-size: 1.2rem; font-weight: bold; color: #4f46e5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const RechartsObj = window.Recharts || {};
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } = RechartsObj;

        // --- SafeChart Tanƒ±mlamasƒ± ---
        const SafeChart = ({ data, dataKey, color = "#4f46e5" }) => {
            if (!RechartsObj.LineChart) return <div>Grafik Y√ºkleniyor...</div>;
            if (!data || data.length === 0) return <div className="flex h-full items-center justify-center text-gray-400 text-sm">Veri yok</div>;

            const keyToUse = dataKey || (data[0]?.wpm ? "wpm" : "score");

            return (
               <ResponsiveContainer width="100%" height="100%">
                 <LineChart data={data}>
                   <CartesianGrid strokeDasharray="3 3" />
                   <XAxis dataKey="date" fontSize={10} tick={{fill: '#6b7280'}} tickFormatter={(v) => (v ? String(v).split(' ')[0] : '')} />
                   <YAxis fontSize={10} tick={{fill: '#6b7280'}} />
                   <Tooltip />
                   <Line type="monotone" dataKey={keyToUse} stroke={color} strokeWidth={3} dot={{r: 4}} />
                 </LineChart>
               </ResponsiveContainer>
            );
        };

        // --- VERƒ∞ SERVƒ∞Sƒ∞ ---
        const DataService = {
            scriptUrl: 'https://script.google.com/macros/s/AKfycbyiiR4V-HoqDuLxXIkAC_4ayU-ecgEg8ysdLyYk8Za8Qw3UW23eYylyM2qZbj3nqqu5bg/exec',

            async request(action, data = {}) {
                try {
                    const url = new URL(this.scriptUrl);
                    url.searchParams.append('action', action);
                    url.searchParams.append('data', JSON.stringify(data));
                    url.searchParams.append('_', new Date().getTime());

                    const response = await fetch(url.toString(), { method: 'GET' });
                    const json = await response.json();
                    return json;
                } catch (error) {
                    console.error("Baƒülantƒ± Hatasƒ±:", error);
                    return this.mockRequest(action, data);
                }
            },

            mockRequest(action, data) {
                return new Promise(resolve => {
                    const users = JSON.parse(localStorage.getItem('mock_users')) || [];
                    const stats = JSON.parse(localStorage.getItem('mock_stats')) || {};
                    const storedTexts = JSON.parse(localStorage.getItem('mock_texts'));
                    const texts = storedTexts || INITIAL_TEXTS;
                    const config = JSON.parse(localStorage.getItem('mock_config')) || {};
                    
                    if (action === 'getUsers') resolve({ success: true, users });
                    else if (action === 'getTexts') resolve({ success: true, texts });
                    else if (action === 'getConfig') resolve({ success: true, config }); 
                    else if (action === 'addUser') {
                        const newUser = { id: Date.now().toString(), name: data.name, password: data.password, role: 'student' };
                        localStorage.setItem('mock_users', JSON.stringify([...users, newUser]));
                        resolve({ success: true, user: newUser });
                    }
                    else if (action === 'deleteUser') {
                        const filtered = users.filter(u => String(u.id) !== String(data.id));
                        localStorage.setItem('mock_users', JSON.stringify(filtered));
                        resolve({ success: true });
                    }
                    else if (action === 'addText') {
                        const newText = { ...data, id: Date.now() };
                        localStorage.setItem('mock_texts', JSON.stringify([...texts, newText]));
                        resolve({ success: true });
                    }
                    else if (action === 'deleteText') {
                        const filteredTexts = texts.filter(t => String(t.id) !== String(data.id));
                        localStorage.setItem('mock_texts', JSON.stringify(filteredTexts));
                        resolve({ success: true });
                    }
                    else if (action === 'saveStat') { 
                        const userStats = stats[data.userId] || [];
                        userStats.push({ ...data, date: new Date().toLocaleString() });
                        stats[data.userId] = userStats;
                        localStorage.setItem('mock_stats', JSON.stringify(stats));
                        resolve({ success: true });
                    }
                    else if (action === 'saveConfig') {
                        const newConfig = { ...config, ...data };
                        localStorage.setItem('mock_config', JSON.stringify(newConfig));
                        resolve({ success: true });
                    }
                    else if (action === 'getStats') resolve({ success: true, stats: stats[data.userId] || [] });
                });
            }
        };

        // --- ƒ∞KONLAR (GLOBAL) ---
        const IconBase = ({ children, ...props }) => ( <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg> );
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconBase>;
        const BookOpen = (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></IconBase>;
        const Activity = (props) => <IconBase {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></IconBase>;
        const Settings = (props) => <IconBase {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></IconBase>;
        const UserIcon = (props) => <IconBase {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></IconBase>;
        const Lock = (props) => <IconBase {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></IconBase>;
        const LogOut = (props) => <IconBase {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></IconBase>;
        const Plus = (props) => <IconBase {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></IconBase>;
        const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3"></polygon></IconBase>;
        const BarChart2 = (props) => <IconBase {...props}><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></IconBase>;
        const Brain = (props) => <IconBase {...props}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"></path><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"></path></IconBase>;
        const X = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconBase>;
        const ArrowRight = (props) => <IconBase {...props}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></IconBase>;
        const ThumbsUp = (props) => <IconBase {...props}><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></IconBase>;
        const ThumbsDown = (props) => <IconBase {...props}><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></IconBase>;
        const Clock = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></IconBase>;
        const Cloud = (props) => <IconBase {...props}><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></IconBase>;
        const List = (props) => <IconBase {...props}><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></IconBase>;
        const Edit = (props) => <IconBase {...props}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></IconBase>;
        const ArrowLeft = (props) => <IconBase {...props}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></IconBase>;

        // --- YARDIMCI FONKSƒ∞YONLAR ---
        const generateRandomNumber = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const shuffleArray = (array) => [...array].sort(() => Math.random() - 0.5);
        const randomizeCase = (w) => Math.random() > 0.5 ? w.charAt(0).toLowerCase() + w.slice(1) : w.charAt(0).toUpperCase() + w.slice(1);
        
        // Akƒ±llƒ± Typo Algoritmasƒ±
        const createTypo = (word) => {
          if (!word || word.length < 2) return word + 'x';
          const vowels = "aeƒ±io√∂u√º";
          const consonants = "bc√ßdfgƒühjklmnprs≈ütvyz";
          const chars = word.split('');
          const idx = Math.floor(Math.random() * word.length);
          const char = chars[idx].toLowerCase();
          let replacements = "";
          if (vowels.includes(char)) replacements = vowels;
          else if (consonants.includes(char)) replacements = consonants;
          else replacements = "abc"; 
          let newChar = replacements[Math.floor(Math.random() * replacements.length)];
          while(newChar === char && replacements.length > 1) {
              newChar = replacements[Math.floor(Math.random() * replacements.length)];
          }
          chars[idx] = newChar;
          return chars.join('');
        };

        const INITIAL_TEXTS = [
          {
            id: 1,
            title: "Karga ile Su Testisi",
            content: "√áok susamƒ±≈ü bir karga, azƒ±cƒ±k su bulunan bir testi buldu. Fakat testinin aƒüzƒ± dar olduƒüundan gagasƒ±nƒ± uzatƒ±p suyu i√ßemedi. Karga d√º≈ü√ºnd√º, ta≈üƒ±ndƒ± ve aklƒ±na bir fikir geldi. Yerden k√º√ß√ºk √ßakƒ±l ta≈ülarƒ±nƒ± toplayƒ±p testinin i√ßine atmaya ba≈üladƒ±. Ta≈ülar dolduk√ßa su y√ºkseldi. Sonunda su, karganƒ±n i√ßebileceƒüi seviyeye geldi ve karga kana kana su i√ßti.",
            level: 1,
            questions: [
              { q: "Karga suyu neden i√ßemedi?", options: ["Su √ßok sƒ±caktƒ±", "Testinin aƒüzƒ± dardƒ±", "Suyu sevmedi", "Gagasƒ± kƒ±rƒ±ldƒ±"], answer: 1 },
              { q: "Karganƒ±n aklƒ±na nasƒ±l bir fikir geldi?", options: ["Testiyi kƒ±rmak", "Ba≈ükasƒ±na yardƒ±m istemek", "ƒ∞√ßine ta≈ü atmak", "Yaƒümur yaƒümasƒ±nƒ± beklemek"], answer: 2 },
              { q: "Ta≈ülar atƒ±lƒ±nca suya ne oldu?", options: ["Su kirlendi", "Su d√∂k√ºld√º", "Su buharla≈ütƒ±", "Su y√ºkseldi"], answer: 3 },
              { q: "Hikayenin ana fikri nedir?", options: ["Kaba kuvvet her ≈üeyi √ß√∂zer", "Zeka ve sabƒ±rla zorluklar a≈üƒ±lƒ±r", "Kargalar suyu sever", "Testiler dar aƒüƒ±zlƒ± olmamalƒ±dƒ±r"], answer: 1 },
              { q: "Karga ba≈ülangƒ±√ßta ne durumdaydƒ±?", options: ["√áok a√ßtƒ±", "√áok uykusuzdu", "√áok susamƒ±≈ütƒ±", "√áok yorgundu"], answer: 2 }
            ]
          },
          { 
            id: 2, 
            title: "Aslan ile Fare", 
            content: "Ormanlar kralƒ± aslan bir g√ºn uyurken, minik bir fare onun √ºzerinde dola≈ümaya ba≈ülamƒ±≈ü. Aslan uyanƒ±p fareyi yakalamƒ±≈ü. Fare yalvarmƒ±≈ü: 'Bƒ±rak beni, g√ºn olur sana iyiliƒüim dokunur.' Aslan g√ºlm√º≈ü ama fareyi bƒ±rakmƒ±≈ü. G√ºnler sonra aslan avcƒ±larƒ±n tuzaƒüƒ±na d√º≈üm√º≈ü. K√ºkremesini duyan fare gelmi≈ü, ipleri kemirerek aslanƒ± kurtarmƒ±≈ü. Aslan, k√º√ß√ºk bir farenin bile b√ºy√ºk i≈üler yapabileceƒüini anlamƒ±≈ü.", 
            level: 2, 
            questions: [
              {q: "Fare aslanƒ± nasƒ±l kurtardƒ±?", options: ["Avcƒ±larƒ± korkutarak", "ƒ∞pleri kemirerek", "Diƒüer hayvanlarƒ± √ßaƒüƒ±rarak", "Anahtarƒ± bularak"], answer: 1},
              {q: "Aslan fareyi ilk ba≈üta neden serbest bƒ±raktƒ±?", options: ["Fareden korktuƒüu i√ßin", "Farenin yalvarmasƒ±na g√ºld√ºƒü√º i√ßin", "Karnƒ± tok olduƒüu i√ßin", "Fare ka√ßtƒ±ƒüƒ± i√ßin"], answer: 1},
              {q: "Aslan neyin tuzaƒüƒ±na d√º≈üt√º?", options: ["Bir √ßukurun", "Avcƒ±larƒ±n aƒüƒ±nƒ±n", "B√ºy√ºk bir kafesin", "Bataklƒ±ƒüƒ±n"], answer: 1},
              {q: "Hikayenin ana fikri nedir?", options: ["G√º√ßl√ºler her zaman kazanƒ±r", "K√º√ß√ºk dostlar b√ºy√ºk i≈üler ba≈üarabilir", "Aslanlar ormanƒ±n kralƒ±dƒ±r", "Avcƒ±lar tehlikelidir"], answer: 1},
              {q: "Fare aslanƒ±n √ºzerinde ne yapƒ±yordu?", options: ["Yemek yiyordu", "Uyuyordu", "Dola≈üƒ±yordu", "Saklanƒ±yordu"], answer: 2}
            ] 
          },
          { 
            id: 3, 
            title: "Tilki ile √úz√ºm", 
            content: "Bir tilki, karnƒ± a√ß bir ≈üekilde ormanda dola≈üƒ±yordu. Ba≈üƒ±nƒ± yukarƒ± kaldƒ±rdƒ±ƒüƒ±nda, bir asmadan sarkan nefis √ºz√ºm salkƒ±mlarƒ± g√∂rd√º. √úz√ºmler olgundu ve i≈ütah a√ßƒ±cƒ± g√∂r√ºn√ºyordu. Tilki zƒ±pladƒ± ama yeti≈üemedi. Bir daha denedi, yine olmadƒ±. Defalarca zƒ±plamasƒ±na raƒümen √ºz√ºmlere ula≈üamadƒ±. Sonunda yorgun d√º≈üen tilki, 'Zaten bu √ºz√ºmler korukmu≈ü, yenmezmi≈ü' diyerek oradan uzakla≈ütƒ±.", 
            level: 3, 
            questions: [
              {q: "Tilki √ºz√ºmlere ula≈üamayƒ±nca ne dedi?", options: ["√áok lezzetliymi≈ü", "Zaten korukmu≈ü", "Yarƒ±n gelirim", "Boyum yetmedi"], answer: 1},
              {q: "Tilki ormanda neden dola≈üƒ±yordu?", options: ["Arkada≈ü arƒ±yordu", "Spor yapƒ±yordu", "Karnƒ± a√ßtƒ±", "Yolu kaybetmi≈üti"], answer: 2},
              {q: "Tilki √ºz√ºmlere ula≈ümak i√ßin ne yaptƒ±?", options: ["Aƒüaca tƒ±rmandƒ±", "Merdiven buldu", "Zƒ±pladƒ±", "Ta≈ü attƒ±"], answer: 2},
              {q: "Hikayedeki 'koruk' ne anlama gelir?", options: ["Olgunla≈ümamƒ±≈ü ek≈üi √ºz√ºm", "√á√ºr√ºk meyve", "Kuru dal", "Zehirli bitki"], answer: 0},
              {q: "Tilki sonunda ne yaptƒ±?", options: ["√úz√ºmleri yedi", "Aƒüladƒ±", "Vazge√ßip gitti", "Uyudu"], answer: 2}
            ] 
          },
          { 
            id: 4, 
            title: "Tav≈üan ile Kaplumbaƒüa", 
            content: "Tav≈üan, hƒ±zƒ±yla √∂v√ºnmeyi √ßok severdi. Kaplumbaƒüa ise yava≈ülƒ±ƒüƒ±yla bilinirdi. Bir g√ºn yarƒ±≈ümaya karar verdiler. Yarƒ±≈ü ba≈üladƒ±, tav≈üan ok gibi fƒ±rladƒ±. Yarƒ± yola gelince 'Nasƒ±lsa kaplumbaƒüa √ßok geride, ≈üurada biraz uyuyayƒ±m' dedi. Kaplumbaƒüa ise hi√ß durmadan, yava≈ü ama kararlƒ± adƒ±mlarla y√ºr√ºd√º. Tav≈üan uyandƒ±ƒüƒ±nda bir de baktƒ± ki kaplumbaƒüa biti≈ü √ßizgisine varmƒ±≈ü. Yarƒ±≈üƒ± kazanan, azimle devam eden kaplumbaƒüa oldu.", 
            level: 4, 
            questions: [
              {q: "Yarƒ±≈üƒ± kim kazandƒ±?", options: ["Tav≈üan", "Kaplumbaƒüa", "Tilki", "Hakem"], answer: 1},
              {q: "Tav≈üan yarƒ±≈ü sƒ±rasƒ±nda ne yaptƒ±?", options: ["Havu√ß yedi", "Su i√ßti", "Uyudu", "Kitap okudu"], answer: 2},
              {q: "Kaplumbaƒüanƒ±n kazanmasƒ±nƒ± saƒülayan √∂zellik neydi?", options: ["Hƒ±zlƒ± olmasƒ±", "Kurnazlƒ±ƒüƒ±", "Kararlƒ± ve azimli olmasƒ±", "≈ûanslƒ± olmasƒ±"], answer: 2},
              {q: "Tav≈üan neyi ile √∂v√ºn√ºrd√º?", options: ["Zekasƒ±yla", "Hƒ±zƒ±yla", "G√ºzelliƒüiyle", "G√ºc√ºyle"], answer: 1},
              {q: "Tav≈üan uyandƒ±ƒüƒ±nda ne g√∂rd√º?", options: ["Hala √∂nde olduƒüunu", "Yarƒ±≈üƒ±n bittiƒüini", "Kaplumbaƒüanƒ±n biti≈üe vardƒ±ƒüƒ±nƒ±", "Hava karardƒ±ƒüƒ±nƒ±"], answer: 2}
            ] 
          },
          { 
            id: 5, 
            title: "Aƒüustos B√∂ceƒüi ile Karƒ±nca", 
            content: "Yaz boyunca Aƒüustos b√∂ceƒüi saz √ßaldƒ±, ≈üarkƒ± s√∂yledi ve eƒülendi. Karƒ±nca ise hi√ß durmadan √ßalƒ±≈ütƒ±, kƒ±≈ü i√ßin yuvasƒ±na yiyecek ta≈üƒ±dƒ±. Aƒüustos b√∂ceƒüi karƒ±ncaya g√ºl√ºp, 'Bu g√ºzel havanƒ±n tadƒ±nƒ± √ßƒ±karsana' dedi. Karƒ±nca, 'Kƒ±≈ü gelince a√ß kalmamak i√ßin √ßalƒ±≈ümalƒ±yƒ±m' diye cevap verdi. G√ºnler ge√ßti, havalar soƒüudu ve kƒ±≈ü geldi. Her yer karla kaplandƒ±. Aƒüustos b√∂ceƒüi yiyecek bulamadƒ± ve a√ß kaldƒ±. Titreyerek karƒ±ncanƒ±n kapƒ±sƒ±nƒ± √ßaldƒ±. Karƒ±nca ise sƒ±cacƒ±k yuvasƒ±nda rahattƒ±. Aƒüustos b√∂ceƒüi hatasƒ±nƒ± anladƒ± ama i≈ü i≈üten ge√ßmi≈üti.", 
            level: 5, 
            questions: [
              {q: "Karƒ±nca ne yaptƒ±?", options: ["Yattƒ±", "√áalƒ±≈ütƒ±", "Gezdi", "Uyudu"], answer: 1},
              {q: "Aƒüustos b√∂ceƒüi yazƒ±n ne yaptƒ±?", options: ["√áalƒ±≈ütƒ±", "Eƒülendi ve saz √ßaldƒ±", "Yuva yaptƒ±", "Yemek topladƒ±"], answer: 1},
              {q: "Kƒ±≈ü gelince Aƒüustos b√∂ceƒüinin durumu neydi?", options: ["√áok mutluydu", "Toktu", "A√ß ve √º≈ü√ºm√º≈üt√º", "Sƒ±cak evindeydi"], answer: 2},
              {q: "Karƒ±nca neden yazƒ±n √ßalƒ±≈ütƒ±?", options: ["Canƒ± sƒ±kƒ±ldƒ±ƒüƒ± i√ßin", "Spor olsun diye", "Kƒ±≈üa hazƒ±rlƒ±k yapmak i√ßin", "Emir aldƒ±ƒüƒ± i√ßin"], answer: 2},
              {q: "Hikayenin ana fikri nedir?", options: ["Eƒülenmek her ≈üeyden √∂nemlidir", "Geleceƒüi d√º≈ü√ºn√ºp √ßalƒ±≈ümak gerekir", "Yazƒ±n tatil yapƒ±lmalƒ±dƒ±r", "M√ºzik ruhun gƒ±dasƒ±dƒ±r"], answer: 1}
            ] 
          },
          { 
            id: 6, 
            title: "R√ºzgar ile G√ºne≈ü", 
            content: "Bir g√ºn r√ºzgar ile g√ºne≈ü, hangisinin daha g√º√ßl√º olduƒüu konusunda tartƒ±≈ümaya ba≈üladƒ±lar. O sƒ±rada yolda kalƒ±n bir palto giymi≈ü bir adam y√ºr√ºyordu. R√ºzgar, 'Ben o adamƒ±n paltosunu √ßƒ±karƒ±rƒ±m' dedi ve t√ºm g√ºc√ºyle esmeye ba≈üladƒ±. Fƒ±rtƒ±na gibi esti ama o estik√ße adam paltosuna daha sƒ±kƒ± sarƒ±ldƒ±. R√ºzgar yoruldu ve pes etti. Sƒ±ra g√ºne≈üe geldi. G√ºne≈ü bulutlarƒ±n arkasƒ±ndan √ßƒ±ktƒ± ve nazik√ße parlamaya ba≈üladƒ±. Hava ƒ±sƒ±ndƒ±k√ßa adam terledi. √ñnce d√ºƒümelerini a√ßtƒ±, sonra sƒ±cak dayanƒ±lamaz hale gelince paltosunu √ßƒ±karƒ±p koluna aldƒ±. G√ºne≈ü, nezaketin kaba kuvvetten daha etkili olduƒüunu kanƒ±tladƒ±.", 
            level: 6, 
            questions: [
              {q: "Yarƒ±≈ümayƒ± kim kazandƒ±?", options: ["R√ºzgar", "Adam", "G√ºne≈ü", "Bulut"], answer: 2},
              {q: "R√ºzgar adamƒ±n paltosunu √ßƒ±karmak i√ßin ne yaptƒ±?", options: ["Sƒ±cak √ºfledi", "≈ûiddetle esti", "Yaƒümur yaƒüdƒ±rdƒ±", "Konu≈ütu"], answer: 1},
              {q: "G√ºne≈ü ne yaparak kazandƒ±?", options: ["Daha √ßok parlayƒ±p ƒ±sƒ±tarak", "R√ºzgarƒ± iterek", "Bulutlarƒ± √ßaƒüƒ±rarak", "Adama seslenerek"], answer: 0},
              {q: "R√ºzgar estik√ße adam ne yaptƒ±?", options: ["Paltosunu √ßƒ±kardƒ±", "Paltosuna sƒ±kƒ±ca sarƒ±ldƒ±", "≈ûapkasƒ±nƒ± attƒ±", "Ko≈ütu"], answer: 1},
              {q: "Hikayenin dersi nedir?", options: ["G√º√ß her ≈üeyi √ß√∂zer", "Nezaket zorbalƒ±ktan √ºst√ºnd√ºr", "Hava durumu deƒüi≈üebilir", "Kƒ±≈üƒ±n kalƒ±n giyinmeli"], answer: 1}
            ] 
          },
          { 
            id: 7, 
            title: "Altƒ±n Yumurtlayan Tavuk", 
            content: "Bir zamanlar fakir bir k√∂yl√ºn√ºn bir tavuƒüu vardƒ±. Bu tavuk, diƒüerlerinden farklƒ±ydƒ± √ß√ºnk√º her g√ºn bir tane altƒ±n yumurta yumurtluyordu. K√∂yl√º bu yumurtalarƒ± satarak kƒ±sa s√ºrede zengin oldu. Ancak k√∂yl√º √ßok a√ßg√∂zl√ºyd√º. Her g√ºn sadece bir yumurta almak ona yetmiyordu. 'Tavuƒüun i√ßinde hazine olmalƒ±, hepsini birden almalƒ±yƒ±m' diye d√º≈ü√ºnd√º. Bir g√ºn dayanamayƒ±p tavuƒüu kesti. Fakat tavuƒüun i√ßi diƒüer tavuklardan farksƒ±zdƒ±. Ne hazine vardƒ± ne de altƒ±n. A√ßg√∂zl√º k√∂yl√º, elindeki deƒüerli tavuƒüu da kaybetmi≈ü oldu ve eski fakir g√ºnlerine geri d√∂nd√º.", 
            level: 7, 
            questions: [
              {q: "K√∂yl√º tavuƒüu neden kesti?", options: ["Yemek i√ßin", "Hasta olduƒüu i√ßin", "ƒ∞√ßindeki t√ºm altƒ±nlarƒ± almak i√ßin", "Ya≈ülandƒ±ƒüƒ± i√ßin"], answer: 2},
              {q: "Tavuƒüun √∂zelliƒüi neydi?", options: ["√áok b√ºy√ºkt√º", "Altƒ±n yumurtluyordu", "Konu≈üabiliyordu", "Mavi renkliydi"], answer: 1},
              {q: "Tavuƒüu kesince ne buldu?", options: ["B√ºy√ºk bir hazine", "Hi√ßbir ≈üey, normal bir tavuk i√ßi", "Bir kese altƒ±n", "Elmaslar"], answer: 1},
              {q: "K√∂yl√ºn√ºn yaptƒ±ƒüƒ± hata neydi?", options: ["Tembellik", "Korkaklƒ±k", "A√ßg√∂zl√ºl√ºk", "C√∂mertlik"], answer: 2},
              {q: "Sonunda k√∂yl√ºye ne oldu?", options: ["Daha zengin oldu", "Eski fakir haline d√∂nd√º", "Kral oldu", "Ba≈üka tavuk aldƒ±"], answer: 1}
            ] 
          },
          { 
            id: 8, 
            title: "Yalancƒ± √áoban", 
            content: "K√∂y√ºn birinde koyunlarƒ± otlatan bir √ßoban varmƒ±≈ü. Canƒ± sƒ±kƒ±lan √ßoban, k√∂yl√ºlere ≈üaka yapmak istemi≈ü. K√∂ye doƒüru ko≈üarak 'Kurt var! Kurt saldƒ±rƒ±yor!' diye baƒüƒ±rmƒ±≈ü. K√∂yl√ºler i≈ülerini bƒ±rakƒ±p yardƒ±ma ko≈ümu≈ülar ama ortada kurt falan yokmu≈ü. √áoban g√ºlerek '≈ûaka yaptƒ±m' demi≈ü. K√∂yl√ºler kƒ±zmƒ±≈ü ama geri d√∂nm√º≈üler. Birka√ß g√ºn sonra √ßoban aynƒ± ≈üakayƒ± tekrar yapmƒ±≈ü. K√∂yl√ºler yine yardƒ±ma gelmi≈ü, yine kandƒ±rƒ±ldƒ±klarƒ±nƒ± anlamƒ±≈ülar. G√ºnlerden bir g√ºn, ger√ßekten s√ºr√ºye bir kurt saldƒ±rmƒ±≈ü. √áoban korkuyla 'Kurt var! Yardƒ±m edin!' diye baƒüƒ±rmƒ±≈ü. Ancak k√∂yl√ºler, √ßobanƒ±n yine yalan s√∂ylediƒüini d√º≈ü√ºnerek yardƒ±ma gitmemi≈üler. Kurt, s√ºr√ºdeki koyunlarƒ± kapmƒ±≈ü. √áoban, yalancƒ±lƒ±ƒüƒ±nƒ±n bedelini aƒüƒ±r √∂demi≈ü.", 
            level: 8, 
            questions: [
              {q: "K√∂yl√ºler son seferde neden yardƒ±ma gelmedi?", options: ["Duymadƒ±lar", "√áobana inanmadƒ±lar", "Korktular", "Me≈üguld√ºler"], answer: 1},
              {q: "√áoban ilk ba≈üta neden baƒüƒ±rdƒ±?", options: ["Kurt g√∂rd√ºƒü√º i√ßin", "Korktuƒüu i√ßin", "≈ûaka yapmak i√ßin", "Koyunlarƒ± kaybettiƒüi i√ßin"], answer: 2},
              {q: "Ger√ßek kurt gelince ne oldu?", options: ["√áoban kurdu ka√ßƒ±rdƒ±", "K√∂yl√ºler kurdu yakaladƒ±", "Kurt koyunlarƒ± kaptƒ±", "K√∂pekler kurdu kovaladƒ±"], answer: 2},
              {q: "K√∂yl√ºler ≈üakayƒ± √∂ƒürenince ne hissetti?", options: ["G√ºld√ºler", "Kƒ±zdƒ±lar", "Umursamadƒ±lar", "Sevindiler"], answer: 1},
              {q: "Hikayeden ne ders √ßƒ±karƒ±rƒ±z?", options: ["Yalancƒ±ya doƒüru s√∂ylese de inanƒ±lmaz", "≈ûaka yapmak komiktir", "√áobanlƒ±k zordur", "Kurtlar hƒ±zlƒ± ko≈üar"], answer: 0}
            ] 
          },
          { 
            id: 9, 
            title: "≈ûehir Faresi ile Tarla Faresi", 
            content: "Bir g√ºn ≈üehir faresi, uzaktan akrabasƒ± olan tarla faresini ziyarete gitmi≈ü. Tarla faresi misafirine buƒüday, k√∂kler ve mƒ±sƒ±r ikram etmi≈ü. ≈ûehir faresi, 'Sen burada √ßok fakir ya≈üƒ±yorsun, gel benimle ≈üehre gidelim, orada krallar gibi ya≈üarƒ±z' demi≈ü. Birlikte ≈üehre, b√ºy√ºk bir konaƒüa gitmi≈üler. Sofrada peynirler, pastalar, etler varmƒ±≈ü. Tam yemeye ba≈ülayacaklarken kapƒ± a√ßƒ±lmƒ±≈ü, i√ßeri insanlar girmi≈ü. Fareler korkuyla deliƒüe ka√ßmƒ±≈ü. Saklandƒ±klarƒ± yerde titrerken evin kedisi gelmi≈ü, onlarƒ± kovalamƒ±≈ü. Tarla faresi korkudan nefes nefese kalmƒ±≈ü. 'Benim evimde yiyecekler az ama huzurum var' demi≈ü. 'Senin sofralarƒ±n zengin ama korku i√ßinde ya≈üƒ±yorsun. Ben fakir ama √∂zg√ºr hayatƒ±mƒ± tercih ederim.' diyerek tarlasƒ±na geri d√∂nm√º≈ü.", 
            level: 9, 
            questions: [
              {q: "Tarla faresi neden geri d√∂nd√º?", options: ["Yemeƒüi beƒüenmedi", "Korku i√ßinde ya≈üamak istemedi", "Yolu unuttu", "K√∂y√ºn√º √∂zledi"], answer: 1},
              {q: "≈ûehir faresi arkada≈üƒ±na ne teklif etti?", options: ["Tarlada kalmayƒ±", "≈ûehre gelip zengin ya≈üamayƒ±", "Ormanda gezmeyi", "Oyun oynamayƒ±"], answer: 1},
              {q: "≈ûehirdeki evde onlarƒ± ne korkuttu?", options: ["Sadece r√ºzgar", "Sadece kedi", "ƒ∞nsanlar ve kedi", "Diƒüer fareler"], answer: 2},
              {q: "Tarla faresi misafirine ne ikram etti?", options: ["Peynir ve et", "Pasta", "Buƒüday ve mƒ±sƒ±r", "Bal"], answer: 2},
              {q: "Hikayenin ana fikri nedir?", options: ["Zenginlik her ≈üeydir", "≈ûehir hayatƒ± zordur", "Huzurlu fakirlik, korkulu zenginlikten iyidir", "Fareler peynir sever"], answer: 2}
            ] 
          },
          { 
            id: 10, 
            title: "Keloƒülan ve Sihirli Ku≈ü", 
            content: "Bir varmƒ±≈ü, bir yokmu≈ü. Evvel zaman i√ßinde, kalbur saman i√ßinde, uzak diyarlarƒ±n birinde Keloƒülan ile ya≈ülƒ± annesi ya≈üarmƒ±≈ü. Fakirlik bellerini b√ºkm√º≈ü, yiyecek bir lokma ekmekleri kalmamƒ±≈ü. Keloƒülan bir g√ºn ormana odun toplamaya gitmi≈ü. Ormanƒ±n derinliklerinde, t√ºyleri g√∂kku≈üaƒüƒ± gibi parlayan, kanatlarƒ± altƒ±ndan daha parlak, e≈üi benzeri g√∂r√ºlmemi≈ü bir ku≈ü g√∂rm√º≈ü. Ku≈üun ayaƒüƒ± bir √ßalƒ±ya takƒ±lmƒ±≈ü, √ßƒ±rpƒ±nƒ±p duruyormu≈ü. Keloƒülan'ƒ±n y√ºreƒüi el vermemi≈ü, hemen ko≈üup ku≈üu kurtarmƒ±≈ü. Ku≈ü dile gelmi≈ü: 'Ey iyi kalpli Keloƒülan! Sen beni kurtardƒ±n, ben de sana bir iyilik yapacaƒüƒ±m. Al bu t√ºy√ºm√º, ne zaman ba≈üƒ±n sƒ±kƒ±≈üƒ±rsa bu t√ºy√º yak, ben hemen gelirim.' demi≈ü ve u√ßup gitmi≈ü.\n\nG√ºnler ge√ßmi≈ü, padi≈üahƒ±n kƒ±zƒ± amansƒ±z bir hastalƒ±ƒüa yakalanmƒ±≈ü. √úlkenin t√ºm hekimleri gelmi≈ü ama √ßare bulamamƒ±≈ülar. Padi≈üah, kƒ±zƒ±nƒ± iyile≈ütirene aƒüƒ±rlƒ±ƒüƒ±nca altƒ±n vereceƒüini duyurmu≈ü. Keloƒülan bunu duyunca aklƒ±na sihirli ku≈ü gelmi≈ü. Hemen t√ºy√º yakmƒ±≈ü. Anƒ±nda g√∂kku≈üaƒüƒ± renkli ku≈ü belirmi≈ü. Keloƒülan durumu anlatmƒ±≈ü. Ku≈ü, 'Kaf daƒüƒ±nƒ±n ardƒ±nda Z√ºmr√ºd√ºanka ku≈üunun g√∂zya≈üƒ±yla sulanan bir √ßi√ßek vardƒ±r. O √ßi√ßeƒüi getirirsen prenses iyile≈üir' demi≈ü ve Keloƒülan'ƒ± sƒ±rtƒ±na alƒ±p Kaf daƒüƒ±na u√ßurmu≈ü.\n\nKeloƒülan zorlu yollardan ge√ßmi≈ü, devlerle sava≈ümƒ±≈ü, bilmeceler √ß√∂zm√º≈ü ve sonunda √ßi√ßeƒüi bulup saraya getirmi≈ü. √ái√ßeƒüi koklayan prenses hemen iyile≈ümi≈ü. Padi≈üah s√∂z√ºn√º tutmu≈ü, Keloƒülan ve annesi √∂m√ºr boyu bolluk i√ßinde, mutlu mesut ya≈üamƒ±≈ülar. G√∂kten √º√ß elma d√º≈üm√º≈ü; biri anlatana, biri dinleyene, biri de iyilik yapƒ±p kar≈üƒ±lƒ±ƒüƒ±nƒ± beklemeyenlere.", 
            level: 10, 
            questions: [
              {q: "Ku≈ü, Keloƒülan'a ne verdi?", options: ["Bir altƒ±n", "Bir t√ºy", "Bir elma", "Bir harita"], answer: 1},
              {q: "Prenses nasƒ±l iyile≈üti?", options: ["ƒ∞la√ß i√ßerek", "Uyuyarak", "Sihirli √ßi√ßeƒüi koklayarak", "Su i√ßerek"], answer: 2},
              {q: "Keloƒülan ku≈üu nerede buldu?", options: ["K√∂y meydanƒ±nda", "Sarayda", "Ormanda odun toplarken", "Pazarda"], answer: 2},
              {q: "Keloƒülan t√ºy√º neden yaktƒ±?", options: ["Isƒ±nmak i√ßin", "Yanlƒ±≈ülƒ±kla", "Yardƒ±m istemek i√ßin", "Karanlƒ±kta kaldƒ±ƒüƒ± i√ßin"], answer: 2},
              {q: "Padi≈üahƒ±n vaadi neydi?", options: ["Aƒüƒ±rlƒ±ƒüƒ±nca altƒ±n", "Yarƒ±m krallƒ±k", "Sihirli at", "Yeni bir ev"], answer: 0}
            ] 
          }
        ];

        const EXERCISE_TYPES = [
          { id: 'kelime_avi', title: 'Kelime Avƒ±', category: 'Dikkat', type: 'grid' },
          { id: 'farkli_kelime', title: 'Farklƒ± Kelime √áifti', category: 'Dikkat', type: 'grid_diff' }, 
          { id: 'cift_tek', title: '√áift/Tek Sayƒ±', category: 'Matematik', type: 'math_logic' }, 
          { id: 'aranan_sayi', title: 'Aranan Sayƒ±yƒ± Bul', category: 'Dikkat', type: 'search_num' }, 
          { id: 'istenen_harf', title: 'ƒ∞stenen Harfleri Bul', category: 'Dikkat', type: 'search_letter' },
          { id: 'goster_kelime', title: 'Kelimeyi Hatƒ±rla', category: 'Hafƒ±za', type: 'flash_memory' },
          { id: 'karisik_kelime', title: 'Karƒ±≈üƒ±k Kelime Bul', category: 'Kelime', type: 'scramble_word' },
          { id: 'goster_cumle', title: 'C√ºmleyi Hatƒ±rla', category: 'Hafƒ±za', type: 'flash_sentence' },
          { id: 'goz_takibi', title: 'G√∂z Takibi (Emoji Sayma)', category: 'G√∂z Kasƒ±', type: 'eye_track_count' },
          { id: 'takistoskop', title: 'Takistoskopik Okuma', category: 'Okuma', type: 'tachistoscope_text' },
        ];

        const DEFAULT_WORD_POOL = [
            "Araba", "Bebek", "Ceviz", "Davul", "Elma", "Fƒ±stƒ±k", "Gemi", "Halƒ±", "I≈üƒ±k", "Jeton",
            "Kalem", "Limon", "Masa", "Nar", "Okul", "Para", "Radyo", "Saat", "Top", "U√ßak",
            "Vazo", "Yol", "Zil", "Aƒüa√ß", "Balƒ±k", "Cam", "Deniz", "Ev", "Fare", "G√∂z",
            "Hava", "ƒ∞p", "Jilet", "Kedi", "Lale", "Muz", "Nehir", "Orman", "Peynir", "Resim",
            "S√ºt", "Tuz", "Un", "Vapur", "Yaƒümur", "Zeytin", "Ay", "Bƒ±√ßak", "Ceket", "Dere",
            "Ekmek", "Fƒ±r√ßa", "G√ºne≈ü", "Halat", "ƒ∞ƒüne", "Jandarma", "Kaƒüƒ±t", "Lamba", "Makas", "Nane",
            "Oda", "Pil", "Renk", "Silgi", "Tarak", "Uyku", "Vadi", "Yastƒ±k", "Zarf", "Akƒ±l",
            "Beyin", "Cesur", "D√ºr√ºst", "Eski", "Fakir", "G√ºzel", "Hƒ±zlƒ±", "ƒ∞yi", "Japon", "Kƒ±sa",
            "Lazƒ±m", "Mutlu", "Nadir", "Orta", "Pahalƒ±", "Rahat", "Sƒ±cak", "Temiz", "Uzun", "Var",
            "Yok", "Zengin", "A√ßƒ±k", "Bo≈ü", "Ciddi", "Dolu", "Erken", "Ge√ß", "Hafif", "ƒ∞nce"
        ];
        const DEFAULT_SENTENCE_POOL = [
            "Bug√ºn hava √ßok g√ºzel.", "Yarƒ±n sinemaya gideceƒüiz.", "Kitap okumayƒ± √ßok seviyorum.",
            "Annem lezzetli yemekler yapar.", "Babam i≈üten ge√ß geldi.", "Karde≈üimle parkta oyun oynadƒ±k.",
            "Okulda yeni arkada≈ülar edindim.", "√ñdevlerimi zamanƒ±nda bitirdim.", "Ak≈üam yemeƒüinde tavuk yedik.",
            "Sabah erkenden kalktƒ±m.", "Di≈ülerimi g√ºnde iki kez fƒ±r√ßalarƒ±m.", "Ellerimizi sƒ±k sƒ±k yƒ±kamalƒ±yƒ±z.",
            "Saƒülƒ±klƒ± beslenmek √∂nemlidir.", "Spor yapmak v√ºcuda iyi gelir.", "M√ºzik dinlemek beni rahatlatƒ±r.",
            "Resim yapmayƒ± √∂ƒürenmek istiyorum.", "Yaz tatilinde denize gireceƒüim.", "Kƒ±≈üƒ±n kardan adam yaparƒ±z.",
            "Sonbaharda yapraklar d√∂k√ºl√ºr.", "ƒ∞lkbaharda √ßi√ßekler a√ßar.", "Doƒüayƒ± korumalƒ±yƒ±z.", "Hayvanlara zarar vermemeliyiz.",
            "Ya≈ülƒ±lara yardƒ±m etmeliyiz.", "K√º√ß√ºklere sevgi g√∂stermeliyiz.", "Yalan s√∂ylemek k√∂t√ºd√ºr.",
            "D√ºr√ºst olmak erdemdir.", "√áalƒ±≈ükan olmak ba≈üarƒ± getirir.", "Tembellikten ka√ßƒ±nmalƒ±yƒ±z.",
            "Zamanƒ± iyi kullanmalƒ±yƒ±z.", "Planlƒ± √ßalƒ±≈ümak √∂nemlidir.", "Hedeflerimize ula≈ümak i√ßin √ßabalamalƒ±yƒ±z.",
            "Hayallerimizin pe≈üinden gitmeliyiz.", "Asla pes etmemeliyiz.", "Hatalarƒ±mƒ±zdan ders √ßƒ±karmalƒ±yƒ±z.",
            "Ba≈üarƒ±sƒ±zlƒ±k ba≈üarƒ±nƒ±n anahtarƒ±dƒ±r.", "√ñƒürenmenin ya≈üƒ± yoktur.", "Her g√ºn yeni bir ≈üeyler √∂ƒürenmeliyiz.",
            "Kitaplar en iyi dostumuzdur.", "Bilgi g√º√ßt√ºr.", "Cahillik mutluluk deƒüildir.", "Saygƒ± g√∂rmek istiyorsan saygƒ± g√∂ster.",
            "Sevgi payla≈ütƒ±k√ßa √ßoƒüalƒ±r.", "G√ºl√ºmsemek sadakadƒ±r.", "ƒ∞yilik yap denize at.", "Damlaya damlaya g√∂l olur.",
            "Sakla samanƒ± gelir zamanƒ±.", "Ayaƒüƒ±nƒ± yorganƒ±na g√∂re uzat.", "√úz√ºm √ºz√ºme baka baka kararƒ±r.",
            "Kom≈üu kom≈üunun k√ºl√ºne muhta√ßtƒ±r.", "Bir elin nesi var iki elin sesi var.", "Birlikten kuvvet doƒüar.",
            "Yalnƒ±z ta≈ü duvar olmaz.", "Aƒüa√ß ya≈üken eƒüilir.", "Demir tavƒ±nda d√∂v√ºl√ºr.", "ƒ∞≈üleyen demir ƒ±≈üƒ±ldar.",
            "Emek olmadan yemek olmaz.", "Zahmetsiz rahmet olmaz.", "Sabƒ±r acƒ±dƒ±r meyvesi tatlƒ±dƒ±r.",
            "Acele i≈üe ≈üeytan karƒ±≈üƒ±r.", "√ñfkeyle kalkan zararla oturur.", "Keskin sirke k√ºp√ºne zarar.",
            "Tatlƒ± dil yƒ±lanƒ± deliƒüinden √ßƒ±karƒ±r.", "S√∂z g√ºm√º≈üse s√ºkut altƒ±ndƒ±r.", "Doƒüru s√∂yleyeni dokuz k√∂yden kovarlar.",
            "Yalancƒ±nƒ±n mumu yatsƒ±ya kadar yanar.", "G√ºne≈ü girmeyen eve doktor girer.", "Saƒülam kafa saƒülam v√ºcutta bulunur.",
            "Erken kalkan yol alƒ±r.", "Vakit nakittir.", "Bug√ºn√ºn i≈üini yarƒ±na bƒ±rakma.", "Tasarruf etmek √∂nemlidir.",
            "ƒ∞sraftan ka√ßƒ±nmalƒ±yƒ±z.", "Suyu bo≈üa harcamamalƒ±yƒ±z.", "Elektriƒüi gereksiz yere kullanmamalƒ±yƒ±z.",
            "Geri d√∂n√º≈ü√ºme √∂nem vermeliyiz.", "√áevremizi temiz tutmalƒ±yƒ±z.", "Aƒüa√ß dikmeliyiz.", "Ormanlarƒ± korumalƒ±yƒ±z.",
            "Denizleri kirletmemeliyiz.", "D√ºnyamƒ±z bizim evimizdir.", "Barƒ±≈ü i√ßinde ya≈üamalƒ±yƒ±z.", "Sava≈ülara hayƒ±r demeliyiz.",
            "√áocuklar geleceƒüimizdir.", "Eƒüitim her √ßocuƒüun hakkƒ±dƒ±r.", "Adalet m√ºlk√ºn temelidir.", "Hukukun √ºst√ºnl√ºƒü√ºne inanmalƒ±yƒ±z.",
            "Demokrasiye sahip √ßƒ±kmalƒ±yƒ±z.", "√ñzg√ºrl√ºk en b√ºy√ºk deƒüerdir.", "ƒ∞nsan haklarƒ±na saygƒ± duymalƒ±yƒ±z.",
            "Herkes e≈üittir.", "Ayrƒ±mcƒ±lƒ±k yapmamalƒ±yƒ±z.", "Farklƒ±lƒ±klara ho≈üg√∂r√ºl√º olmalƒ±yƒ±z.", "Empati kurmalƒ±yƒ±z.",
            "Birbirimizi anlamaya √ßalƒ±≈ümalƒ±yƒ±z.", "ƒ∞leti≈üim kurmak √∂nemlidir.", "Dinlemeyi bilmeliyiz.",
            "Konu≈üurken nazik olmalƒ±yƒ±z.", "Te≈üekk√ºr etmeyi unutmamalƒ±yƒ±z.", "√ñz√ºr dilemek erdemdir.", "Affetmek b√ºy√ºkl√ºkt√ºr."
        ];
        const EMOJI_POOL = ['üçé', 'üçå', 'üçí', 'üçï', 'üöÄ', 'üê±', 'üê∂', '‚öΩ', 'üöó', '‚≠ê', 'üéà', 'üéâ'];
        const ALPHABET = "ABC√áDEFGƒûHƒ∞IJKLMNO√ñPRS≈ûTU√úVYZ";

        // --- ANA Bƒ∞LE≈ûEN ---
        const App = () => {
            const [authState, setAuthState] = useState('login'); 
            const [currentUser, setCurrentUser] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [users, setUsers] = useState([]);
            const [texts, setTexts] = useState([]); 
            const [isLoading, setIsLoading] = useState(false);
            
            // Havuzlar ve Ayarlar
            const [wordPool, setWordPool] = useState(DEFAULT_WORD_POOL);
            const [sentencePool, setSentencePool] = useState(DEFAULT_SENTENCE_POOL);
            const [exerciseSettings, setExerciseSettings] = useState({});
            const [userSettings, setUserSettings] = useState({}); 

            useEffect(() => { fetchInitialData(); }, []);

            const fetchInitialData = async () => {
                setIsLoading(true);
                const uRes = await DataService.request('getUsers');
                if (uRes.success) setUsers(uRes.users);
                
                const tRes = await DataService.request('getTexts');
                if (tRes.success && tRes.texts.length > 0) setTexts(tRes.texts);
                else setTexts(INITIAL_TEXTS);

                const cRes = await DataService.request('getConfig');
                if (cRes.success && cRes.config) {
                     const cfg = cRes.config;
                     if(cfg.wordPool) setWordPool(cfg.wordPool);
                     if(cfg.sentencePool) setSentencePool(cfg.sentencePool);
                     if(cfg.exerciseSettings) setExerciseSettings(cfg.exerciseSettings);
                     if(cfg.userSettings) setUserSettings(cfg.userSettings); 
                }
                setIsLoading(false);
            };

            const handleAdminLogin = (u, p) => {
                if (u === 'arifsametbal' && p === '930770') { setCurrentUser({ id: 'admin', name: 'Arif Samet Bal', role: 'admin' }); setIsAdmin(true); setAuthState('app'); return true; }
                return false;
            };
            const handleUserSelect = (u, p) => { if (u.password && u.password !== p) return false; setCurrentUser(u); setIsAdmin(false); setAuthState('app'); return true; };
            const handleLogout = () => { setCurrentUser(null); setIsAdmin(false); setAuthState('login'); };

            // Ayarlarƒ± Kaydetme
            const saveConfig = async (newWordPool, newSentencePool, newExerciseSettings, newUserSettings) => {
                const config = {
                    wordPool: newWordPool || wordPool,
                    sentencePool: newSentencePool || sentencePool,
                    exerciseSettings: newExerciseSettings || exerciseSettings,
                    userSettings: newUserSettings || userSettings
                };
                if (newWordPool) setWordPool(newWordPool);
                if (newSentencePool) setSentencePool(newSentencePool);
                if (newExerciseSettings) setExerciseSettings(newExerciseSettings);
                if (newUserSettings) setUserSettings(newUserSettings);
                
                localStorage.setItem('mock_config', JSON.stringify(config));
                await DataService.request('saveConfig', config);
            };

            if (authState === 'login') {
                return <><LoginScreen users={users} isLoading={isLoading} onAdminLogin={handleAdminLogin} onUserSelect={handleUserSelect} fetchUsers={fetchInitialData} /></>;
            }

            return (
                <>
                    {isLoading && <div className="loading-overlay"><div>ƒ∞≈ülem Yapƒ±lƒ±yor...</div></div>}
                    <MainApp 
                        currentUser={currentUser} 
                        isAdmin={isAdmin} 
                        onLogout={handleLogout} 
                        allUsers={users}
                        refreshData={fetchInitialData}
                        texts={texts} 
                        setIsLoading={setIsLoading}
                        wordPool={wordPool}
                        sentencePool={sentencePool}
                        exerciseSettings={exerciseSettings}
                        userSettings={userSettings} 
                        saveConfig={saveConfig}
                    />
                </>
            );
        };

        // ... LoginScreen ...
        const LoginScreen = ({ users, isLoading, onAdminLogin, onUserSelect, fetchUsers }) => {
            const [mode, setMode] = useState('user'); 
            const [adminUser, setAdminUser] = useState('');
            const [adminPass, setAdminPass] = useState('');
            const [error, setError] = useState('');
            const [selectedUser, setSelectedUser] = useState(null);
            const [userPass, setUserPass] = useState('');
            const [userError, setUserError] = useState('');

            const doAdminLogin = (e) => {
                e.preventDefault();
                const success = onAdminLogin(adminUser, adminPass);
                if (!success) setError('Hatalƒ± kullanƒ±cƒ± adƒ± veya ≈üifre!');
            };

            const doUserLogin = (e) => {
                e.preventDefault();
                if(!selectedUser) return;
                const success = onUserSelect(selectedUser, userPass);
                if(success) { setSelectedUser(null); setUserPass(''); } 
                else { setUserError('Hatalƒ± ≈üifre!'); }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-blue-800 to-indigo-900 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl overflow-hidden w-full max-w-4xl flex flex-col md:flex-row h-[600px]">
                        <div className="bg-indigo-600 w-full md:w-1/2 p-12 text-white flex flex-col justify-center items-center text-center relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                            <div className="z-10 bg-white/20 p-6 rounded-full mb-6 backdrop-blur-sm">
                                <Zap size={64} className="text-yellow-300" />
                            </div>
                            <h1 className="text-3xl font-bold mb-2 z-10">Hƒ±zlƒ± Okuma</h1>
                            <p className="text-indigo-200 z-10">√ñƒürenci Takip ve Geli≈üim Sistemi</p>
                            <p className="text-indigo-300 text-sm z-10 mt-1">arfsmtbl</p>
                        </div>

                        <div className="w-full md:w-1/2 p-8 md:p-12 flex flex-col relative">
                            <div className="flex gap-4 mb-8 border-b">
                                <button onClick={() => { setMode('user'); setSelectedUser(null); }} className={`pb-2 px-4 font-semibold transition ${mode === 'user' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-gray-400'}`}>√ñƒürenci Giri≈üi</button>
                                <button onClick={() => setMode('admin')} className={`pb-2 px-4 font-semibold transition ${mode === 'admin' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-gray-400'}`}>Y√∂netici Giri≈üi</button>
                            </div>

                            {mode === 'user' ? (
                                selectedUser ? (
                                    <form onSubmit={doUserLogin} className="flex-1 flex flex-col justify-center animate-in">
                                        <button type="button" onClick={() => { setSelectedUser(null); setUserError(''); setUserPass(''); }} className="mb-4 text-sm text-gray-500 hover:text-indigo-600 flex items-center gap-1">‚Üê Geri D√∂n</button>
                                        <div className="text-center mb-6">
                                            <div className="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 mx-auto mb-2">
                                                <UserIcon size={32} />
                                            </div>
                                            <h3 className="text-xl font-bold">{selectedUser.name}</h3>
                                            <p className="text-sm text-gray-500">Giri≈ü yapmak i√ßin ≈üifrenizi girin</p>
                                        </div>
                                        {userError && <div className="bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-4 flex items-center gap-2"><AlertCircle size={16}/>{userError}</div>}
                                        <input type="password" value={userPass} onChange={e => setUserPass(e.target.value)} className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none mb-4 text-center text-lg" placeholder="≈ûifre" autoFocus />
                                        <button type="submit" className="w-full bg-indigo-600 text-white p-3 rounded-lg font-bold hover:bg-indigo-700 transition shadow-lg">Giri≈ü Yap</button>
                                    </form>
                                ) : (
                                    <div className="flex-1 overflow-hidden flex flex-col animate-in">
                                        <h2 className="text-xl font-bold text-gray-800 mb-4">ƒ∞sminizi Se√ßin</h2>
                                        {isLoading ? (
                                            <div className="text-center text-gray-500 py-10">√ñƒürenci listesi y√ºkleniyor...</div>
                                        ) : (
                                            <div className="overflow-y-auto flex-1 pr-2 space-y-2">
                                                {users.length === 0 && <p className="text-gray-400 text-center">Hen√ºz √∂ƒürenci eklenmemi≈ü.</p>}
                                                {users.map(u => (
                                                    <button key={u.id} onClick={() => setSelectedUser(u)} className="w-full text-left p-4 rounded-xl border border-gray-100 hover:border-indigo-500 hover:bg-indigo-50 transition flex items-center gap-3 group">
                                                        <div className="bg-gray-100 text-gray-500 group-hover:bg-indigo-500 group-hover:text-white p-2 rounded-full transition">
                                                            <UserIcon size={20} />
                                                        </div>
                                                        <span className="font-medium text-gray-700 group-hover:text-indigo-700">{u.name}</span>
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                        <div className="mt-4 text-center">
                                            <button onClick={fetchUsers} className="text-sm text-indigo-500 hover:underline flex items-center justify-center gap-1 mx-auto"><span className="text-xs">üîÑ</span> Listeyi Yenile</button>
                                        </div>
                                    </div>
                                )
                            ) : (
                                <form onSubmit={doAdminLogin} className="flex-1 flex flex-col justify-center animate-in">
                                    <h2 className="text-xl font-bold text-gray-800 mb-6">Y√∂netici Paneli</h2>
                                    {error && <div className="bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-4 flex items-center gap-2"><AlertCircle size={16}/>{error}</div>}
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-600 mb-1">Kullanƒ±cƒ± Adƒ±</label>
                                            <input type="text" value={adminUser} onChange={e => setAdminUser(e.target.value)} className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Kullanƒ±cƒ± Adƒ±" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-600 mb-1">≈ûifre</label>
                                            <input type="password" value={adminPass} onChange={e => setAdminPass(e.target.value)} className="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="******" />
                                        </div>
                                        <button type="submit" className="w-full bg-indigo-600 text-white p-3 rounded-lg font-bold hover:bg-indigo-700 transition shadow-lg mt-4 flex items-center justify-center gap-2">
                                            <Lock size={18} /> G√ºvenli Giri≈ü
                                        </button>
                                    </div>
                                </form>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const MainApp = ({ currentUser, isAdmin, onLogout, allUsers, refreshData, texts, setIsLoading, wordPool, sentencePool, exerciseSettings, userSettings, saveConfig }) => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [userStats, setUserStats] = useState({ wpmHistory: [], exerciseStats: {} });
            const [viewingUser, setViewingUser] = useState(currentUser);
            const [notification, setNotification] = useState(null);
            const [currentExercise, setCurrentExercise] = useState(null);

            const lastWpm = userStats.wpmHistory && userStats.wpmHistory.length > 0 
                ? userStats.wpmHistory[userStats.wpmHistory.length - 1].wpm 
                : 200;

            const effectiveWpm = (() => {
                if (userSettings && userSettings[viewingUser.id] && userSettings[viewingUser.id].customWpm) {
                    return parseInt(userSettings[viewingUser.id].customWpm);
                }
                return lastWpm;
            })();

            useEffect(() => { if (!isAdmin) setViewingUser(currentUser); }, [currentUser, isAdmin]);
            useEffect(() => { if (viewingUser) loadUserStats(viewingUser.id); }, [viewingUser]);

            const loadUserStats = async (userId) => {
                if (userId === 'admin') return; 
                const res = await DataService.request('getStats', { userId });
                if (res.success) {
                    const rawStats = res.stats;
                    const wpmHistory = rawStats.filter(s => s.type === 'reading').map(s => ({ ...s, wpm: parseInt(s.score) }));
                    const exerciseStats = {};
                    rawStats.filter(s => s.type !== 'reading').forEach(s => {
                        if (!exerciseStats[s.type]) exerciseStats[s.type] = [];
                        exerciseStats[s.type].push(s);
                    });
                    setUserStats({ wpmHistory, exerciseStats });
                }
            };

            const saveStat = async (type, score, textId = null, extraData = {}) => {
                if (isAdmin && viewingUser.id !== currentUser.id) return;
                const statData = {
                    userId: currentUser.id, type, score, textId, date: new Date().toLocaleString(), ...extraData
                };
                if (type === 'reading') setUserStats(prev => ({...prev, wpmHistory: [...prev.wpmHistory, { ...statData, wpm: score }]}));
                else setUserStats(prev => { const exList = prev.exerciseStats[type] || []; return { ...prev, exerciseStats: { ...prev.exerciseStats, [type]: [...exList, statData] } }; });
                await DataService.request('saveStat', statData);
            };

            const showNotify = (msg, type='success') => {
                setNotification({msg, type});
                setTimeout(() => setNotification(null), 3000);
            };

            const renderContent = () => {
                if (currentExercise) {
                    return (
                        <ExerciseRunner 
                            exercise={currentExercise} 
                            allTexts={texts} 
                            settings={exerciseSettings[currentExercise.id] || {}} 
                            globalSettings={{ generalDuration: 60, eyeTrackDuration: 300, tachiSpeed: 300, eyeTrackSpeed: 1000 }} 
                            onClose={() => setCurrentExercise(null)}
                            onComplete={(score) => { saveStat(currentExercise.id, score); }}
                            wordPool={wordPool}
                            sentencePool={sentencePool}
                            userWpm={effectiveWpm} 
                        />
                    );
                }

                if (activeTab === 'dashboard') return (
                    <Dashboard 
                        stats={userStats} 
                        texts={texts} 
                        user={viewingUser} 
                        onStart={() => setActiveTab('test')} 
                        isAdmin={isAdmin}
                        onBackToUsers={() => { 
                            if(isAdmin) { setActiveTab('admin_users'); setViewingUser(currentUser); } 
                        }}
                    />
                );
                
                if (activeTab === 'test' && !isAdmin) return <ReadingTest texts={texts} readTextIds={[]} onComplete={(res) => { saveStat('reading', res.wpm, res.textId, { accuracy: res.accuracy }); setActiveTab('dashboard'); }} />;
                if (activeTab === 'exercises' && !isAdmin) return <ExerciseMenu onSelect={setCurrentExercise} stats={userStats} />;
                if (activeTab === 'admin_users' && isAdmin) return (
                    <AdminManager 
                        allUsers={allUsers} 
                        refreshData={refreshData} 
                        onSelectUser={(u) => { setViewingUser(u); setActiveTab('dashboard'); }} 
                        showNotify={showNotify}
                        texts={texts}
                        setIsLoading={setIsLoading}
                        wordPool={wordPool}
                        sentencePool={sentencePool}
                        exerciseSettings={exerciseSettings}
                        userSettings={userSettings}
                        saveConfig={saveConfig}
                    />
                );
                return <Dashboard stats={userStats} texts={texts} user={viewingUser} onStart={() => setActiveTab('test')} isAdmin={isAdmin} />;
            };

            return (
                <div className="flex h-screen bg-gray-50 font-sans text-gray-800 overflow-hidden">
                    {notification && (
                        <div className={`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white flex items-center gap-2 ${notification.type === 'error' ? 'bg-red-500' : 'bg-green-600'}`}>
                            {notification.msg}
                        </div>
                    )}
                    
                    <aside className="w-64 bg-indigo-900 text-white flex flex-col shadow-lg">
                        <div className="p-6 border-b border-indigo-800">
                            <h1 className="text-xl font-bold flex items-center gap-2"> <Zap className="text-yellow-400" /> Hƒ±zlƒ± Okuma </h1>
                            <div className="mt-4 flex items-center gap-3 bg-indigo-800/50 p-3 rounded-lg">
                                <div className="bg-indigo-500 p-2 rounded-full"><UserIcon size={16} /></div>
                                <div className="overflow-hidden">
                                    <div className="text-sm font-bold truncate">{currentUser.name}</div>
                                    <div className="text-xs text-indigo-300 uppercase">{isAdmin ? 'Y√∂netici' : '√ñƒürenci'}</div>
                                </div>
                            </div>
                        </div>
                        <nav className="flex-1 p-4 space-y-2">
                            <button onClick={() => { setActiveTab('dashboard'); setCurrentExercise(null); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === 'dashboard' ? 'bg-indigo-700 text-white' : 'text-indigo-200 hover:bg-indigo-800'}`}> <BarChart2 size={20} /> <span>ƒ∞statistikler</span> </button>
                            {!isAdmin && <><button onClick={() => { setActiveTab('test'); setCurrentExercise(null); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === 'test' ? 'bg-indigo-700 text-white' : 'text-indigo-200 hover:bg-indigo-800'}`}> <BookOpen size={20} /> <span>Okuma Testi</span> </button>
                            <button onClick={() => { setActiveTab('exercises'); setCurrentExercise(null); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === 'exercises' ? 'bg-indigo-700 text-white' : 'text-indigo-200 hover:bg-indigo-800'}`}> <Activity size={20} /> <span>Egzersizler</span> </button></>}
                            {isAdmin && <button onClick={() => { setActiveTab('admin_users'); setCurrentExercise(null); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === 'admin_users' ? 'bg-indigo-700 text-white' : 'text-indigo-200 hover:bg-indigo-800'}`}> <Settings size={20} /> <span>Y√∂netici Paneli</span> </button>}
                        </nav>
                        <div className="p-4 border-t border-indigo-800">
                            <button onClick={onLogout} className="w-full flex items-center gap-2 justify-center text-red-300 hover:bg-red-900/30 p-2 rounded transition"> <LogOut size={16} /> √áƒ±kƒ±≈ü Yap </button>
                        </div>
                    </aside>
                    <main className="flex-1 overflow-auto bg-gray-50 p-6">
                        {renderContent()}
                    </main>
                </div>
            );
        };

        const Dashboard = ({ stats, texts, user, onStart, isAdmin, onBackToUsers }) => {
            const lastResult = stats.wpmHistory && stats.wpmHistory.length > 0 ? stats.wpmHistory[stats.wpmHistory.length - 1] : null;
            return (
                <div className="space-y-8 animate-in">
                    <header className="flex justify-between items-center mb-6">
                        <div>
                            {isAdmin && <button onClick={onBackToUsers} className="text-sm text-indigo-600 hover:underline mb-1 flex items-center gap-1"><ArrowLeft size={14}/> Listeye D√∂n</button>}
                            <h2 className="text-2xl font-bold text-gray-800">{user.name} - Geli≈üim Raporu</h2>
                            <p className="text-gray-500">T√ºm zamanlarƒ±n performans √∂zeti</p>
                        </div>
                        {isAdmin && <div className="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-lg font-bold border border-yellow-200">üëÄ ƒ∞zleme Modu</div>}
                    </header>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <StatCard title="Son Okuma Hƒ±zƒ±" value={lastResult ? `${lastResult.wpm} kelime/dk` : '-'} icon={<Zap className="text-yellow-500" />} />
                        <StatCard title="Son Anlama Oranƒ±" value={lastResult && lastResult.accuracy !== undefined ? `%${Number(lastResult.accuracy).toFixed(0)}` : '-'} icon={<Brain className="text-purple-500" />} />
                        <StatCard title="Tamamlanan Egzersiz" value={stats.exerciseStats ? Object.values(stats.exerciseStats).flat().length : 0} icon={<Activity className="text-blue-500" />} />
                    </div>
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-80">
                         <h3 className="text-lg font-semibold mb-4 text-indigo-700">Okuma Hƒ±zƒ± Geli≈üimi</h3>
                         <div className="h-64">{stats.wpmHistory && stats.wpmHistory.length > 0 ? (<SafeChart data={stats.wpmHistory} dataKey="wpm" />) : (<div className="h-full flex items-center justify-center text-gray-400">Hen√ºz okuma verisi yok.</div>)}</div>
                    </div>

                    <h3 className="text-xl font-bold text-gray-800 mt-8 mb-4 border-b pb-2">Egzersiz Performans Grafikleri</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {EXERCISE_TYPES.map(ex => {
                            const data = stats.exerciseStats ? stats.exerciseStats[ex.id] : [];
                            if(!data || data.length === 0) return null;
                            return (
                                <div key={ex.id} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                    <h4 className="font-bold text-gray-700 mb-2">{ex.title}</h4>
                                    <div className="h-40">
                                        <SafeChart data={data} dataKey="score" color="#10b981" />
                                    </div>
                                </div>
                            )
                        })}
                        {(!stats.exerciseStats || Object.keys(stats.exerciseStats).length === 0) && (
                             <div className="col-span-full text-center py-8 text-gray-400 italic bg-gray-50 rounded-xl border border-dashed border-gray-300">
                                Hen√ºz oynanmƒ±≈ü oyun verisi bulunmuyor.
                             </div>
                        )}
                    </div>

                    {!isAdmin && (
                        <div className="text-center py-8">
                            <button onClick={onStart} className="px-8 py-4 bg-indigo-600 text-white rounded-xl font-bold shadow-lg hover:bg-indigo-700 hover:scale-105 transition transform flex items-center gap-2 mx-auto">
                                <Play fill="currentColor" /> Yeni Hƒ±z Testi Ba≈ülat
                            </button>
                        </div>
                    )}
                </div>
            );
        };
        
        const StatCard = ({ title, value, icon }) => (<div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4"><div className="p-3 bg-gray-50 rounded-lg">{icon}</div><div><p className="text-sm text-gray-500">{title}</p><p className="text-2xl font-bold text-gray-800">{value}</p></div></div>);

        const AdminManager = ({ allUsers, refreshData, onSelectUser, texts, setIsLoading, wordPool, sentencePool, exerciseSettings, userSettings, saveConfig, showNotify }) => {
            const [activeTab, setActiveTab] = useState('users'); 
            const [newName, setNewName] = useState('');
            const [newPassword, setNewPassword] = useState('');
            const [scriptUrl, setScriptUrl] = useState(localStorage.getItem('google_script_url') || '');
            const [editingUser, setEditingUser] = useState(null);
            const [customWpmInput, setCustomWpmInput] = useState('');
            const [selectedExerciseId, setSelectedExerciseId] = useState(EXERCISE_TYPES[0].id);
            const [tempSettings, setTempSettings] = useState({});
            const [newItem, setNewItem] = useState('');
            const [newText, setNewText] = useState({ title: '', content: '', level: 1 });
            const [newQuestions, setNewQuestions] = useState(Array(5).fill(null).map(() => ({ q: '', options: ['', '', '', ''], answer: 0 })));

            useEffect(() => { const current = exerciseSettings[selectedExerciseId] || { duration: 60, speed: 500 }; setTempSettings(current); }, [selectedExerciseId, exerciseSettings]);

            const handleSaveUserWpm = () => {
                if (!editingUser) return;
                const newMap = { ...userSettings, [editingUser.id]: { customWpm: customWpmInput } };
                saveConfig(null, null, null, newMap); 
                setEditingUser(null);
                if(showNotify) showNotify("Kullanƒ±cƒ± hƒ±zƒ± kaydedildi!");
            };

             const handleAddUser = async () => {
                if (!newName.trim() || !newPassword.trim()) { if(showNotify) showNotify('Eksik bilgi.', 'error'); return; }
                setIsLoading(true);
                const res = await DataService.request('addUser', { name: newName, password: newPassword });
                setIsLoading(false);
                if (res.success) { setNewName(''); setNewPassword(''); refreshData(); if(showNotify) showNotify('Kullanƒ±cƒ± eklendi'); } 
                else { if(showNotify) showNotify('Hata: ' + res.message, 'error'); }
            };

            const handleDeleteUser = async (id) => {
                if(!confirm('Silmek istediƒüine emin misin?')) return;
                setIsLoading(true);
                const res = await DataService.request('deleteUser', { id });
                setIsLoading(false);
                if (res.success) { refreshData(); if(showNotify) showNotify('Silindi'); }
            };

            const handleAddText = async () => {
                const payload = { ...newText, questions: newQuestions };
                setIsLoading(true);
                const res = await DataService.request('addText', payload);
                setIsLoading(false);
                if (res.success) { setNewText({ title: '', content: '', level: 1 }); setNewQuestions(Array(5).fill(null).map(() => ({ q: '', options: ['', '', '', ''], answer: 0 }))); refreshData(); if(showNotify) showNotify('Metin eklendi!'); }
            };

            const handleDeleteText = async (id) => {
                if(!confirm('Silmek istediƒüine emin misin?')) return;
                setIsLoading(true);
                const res = await DataService.request('deleteText', { id });
                setIsLoading(false);
                if (res.success) { refreshData(); if(showNotify) showNotify('Metin silindi'); }
            };

            const updateQuestion = (idx, field, value, optIdx = null) => {
                const updated = [...newQuestions];
                if (field === 'options' && optIdx !== null) updated[idx].options[optIdx] = value;
                else updated[idx][field] = value;
                setNewQuestions(updated);
            };

             const handleSaveExerciseSettings = () => {
                const newSettings = { ...exerciseSettings, [selectedExerciseId]: tempSettings };
                saveConfig(null, null, newSettings);
                if(showNotify) showNotify('Ayarlar kaydedildi');
            };
            
             const handleAddItem = (poolType) => {
                if (!newItem.trim()) return;
                if (poolType === 'word') { const newPool = [...wordPool, newItem]; saveConfig(newPool, null, null); } 
                else { const newPool = [...sentencePool, newItem]; saveConfig(null, newPool, null); }
                setNewItem('');
                if(showNotify) showNotify('Eklendi');
            };

            const handleDeleteItem = (poolType, index) => {
                if (!confirm('Silinsin mi?')) return;
                if (poolType === 'word') { const newPool = wordPool.filter((_, i) => i !== index); saveConfig(newPool, null, null); } 
                else { const newPool = sentencePool.filter((_, i) => i !== index); saveConfig(null, newPool, null); }
            };
            
             const saveSettings = () => {
                localStorage.setItem('google_script_url', scriptUrl);
                setTimeout(() => window.location.reload(), 500);
            };

            return (
                <div className="space-y-6 animate-in">
                    <div className="flex gap-4 border-b pb-4 overflow-x-auto">
                        <button onClick={() => setActiveTab('users')} className={`px-4 py-2 rounded-lg font-bold transition ${activeTab === 'users' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-100'}`}>√ñƒürenci Y√∂netimi</button>
                        <button onClick={() => setActiveTab('texts')} className={`px-4 py-2 rounded-lg font-bold transition ${activeTab === 'texts' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-100'}`}>Metin Y√∂netimi</button>
                        <button onClick={() => setActiveTab('settings')} className={`px-4 py-2 rounded-lg font-bold transition ${activeTab === 'settings' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-100'}`}>Oyun Ayarlarƒ±</button>
                        <button onClick={() => setActiveTab('pools')} className={`px-4 py-2 rounded-lg font-bold transition ${activeTab === 'pools' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-100'}`}>ƒ∞√ßerik Havuzu</button>
                        <button onClick={() => setActiveTab('cloud')} className={`px-4 py-2 rounded-lg font-bold transition ${activeTab === 'cloud' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-100'}`}>Bulut Baƒülantƒ±sƒ±</button>
                    </div>

                    {activeTab === 'users' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                             <div className="lg:col-span-1 bg-white p-6 rounded-xl shadow-sm border border-gray-200 h-fit">
                                <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-indigo-700"><Plus size={20}/> Yeni √ñƒürenci Ekle</h2>
                                <div className="flex flex-col gap-4">
                                    <input type="text" value={newName} onChange={e => setNewName(e.target.value)} className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Ad Soyad Giriniz" />
                                    <input type="text" value={newPassword} onChange={e => setNewPassword(e.target.value)} className="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="≈ûifre Belirle" />
                                    <button onClick={handleAddUser} className="bg-green-600 text-white p-3 rounded-lg font-bold hover:bg-green-700 flex items-center justify-center gap-2 transition">Kaydet</button>
                                </div>
                            </div>
                            <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                                <h2 className="text-lg font-bold mb-4">Kayƒ±tlƒ± √ñƒürenciler ({allUsers.length})</h2>
                                <div className="overflow-x-auto max-h-[500px] overflow-y-auto">
                                    <table className="w-full text-left">
                                        <thead>
                                            <tr className="bg-gray-50 text-gray-500 text-sm sticky top-0">
                                                <th className="p-4 rounded-tl-lg">ID</th>
                                                <th className="p-4">Ad Soyad</th>
                                                <th className="p-4">≈ûifre</th>
                                                <th className="p-4">Hƒ±z (WPM)</th>
                                                <th className="p-4 rounded-tr-lg text-right">ƒ∞≈ülemler</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y">
                                            {allUsers.map(u => (
                                                <tr key={u.id} className="hover:bg-indigo-50/50 transition">
                                                    <td className="p-4 text-gray-400 text-xs font-mono">{u.id}</td>
                                                    <td className="p-4 font-bold text-gray-800">{u.name}</td>
                                                    <td className="p-4 text-sm text-gray-500 font-mono">{u.password || '-'}</td>
                                                    <td className="p-4 text-sm font-bold text-blue-600">
                                                        {userSettings && userSettings[u.id] && userSettings[u.id].customWpm ? `${userSettings[u.id].customWpm} (Sabit)` : 'Otomatik'}
                                                    </td>
                                                    <td className="p-4 text-right flex justify-end gap-2">
                                                        <button onClick={() => { setEditingUser(u); setCustomWpmInput(userSettings && userSettings[u.id] ? userSettings[u.id].customWpm : ''); }} className="p-2 text-blue-500 hover:bg-blue-100 rounded-lg" title="Hƒ±z Ayarla"><Edit size={18} /></button>
                                                        <button onClick={() => onSelectUser(u)} className="p-2 text-indigo-600 hover:bg-indigo-100 rounded-lg tooltip" title="ƒ∞statistikleri G√∂r"><BarChart2 size={18} /></button>
                                                        <button onClick={() => handleDeleteUser(u.id)} className="flex items-center gap-1 bg-red-100 text-red-600 hover:bg-red-200 px-3 py-2 rounded-lg text-sm font-bold transition" title="Sil"><Trash2 size={16} /> Sil</button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                {editingUser && (
                                    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-in">
                                        <div className="bg-white p-6 rounded-xl shadow-2xl w-96">
                                            <h3 className="text-xl font-bold mb-4">{editingUser.name} ƒ∞√ßin Hƒ±z Ayarƒ±</h3>
                                            <p className="text-sm text-gray-500 mb-4">Bu √∂ƒürenci i√ßin sabit bir okuma hƒ±zƒ± (WPM) belirleyin. Bu hƒ±z, test sonu√ßlarƒ±ndan baƒüƒ±msƒ±z olarak oyunlarda kullanƒ±lacaktƒ±r.</p>
                                            <input type="number" value={customWpmInput} onChange={(e) => setCustomWpmInput(e.target.value)} className="w-full p-3 border rounded-lg mb-4" placeholder="√ñrn: 50" />
                                            <div className="flex gap-2 justify-end">
                                                <button onClick={() => setEditingUser(null)} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">ƒ∞ptal</button>
                                                <button onClick={handleSaveUserWpm} className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Kaydet</button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                    
                    {activeTab === 'texts' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                             <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 h-fit max-h-[800px] overflow-y-auto">
                                <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-indigo-700"><FileText size={20}/> Yeni Metin Ekle</h2>
                                <div className="space-y-4">
                                    <input type="text" value={newText.title} onChange={e => setNewText({...newText, title: e.target.value})} className="w-full p-2 border rounded" placeholder="Metin Ba≈ülƒ±ƒüƒ±" />
                                    <input type="number" value={newText.level} onChange={e => setNewText({...newText, level: parseInt(e.target.value)})} className="w-full p-2 border rounded" placeholder="Seviye (1-10)" />
                                    <textarea value={newText.content} onChange={e => setNewText({...newText, content: e.target.value})} className="w-full p-2 border rounded h-32" placeholder="Metin ƒ∞√ßeriƒüi..."></textarea>
                                    <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                        <h3 className="font-bold text-gray-700 mb-2">Sorular (5 Adet Zorunlu)</h3>
                                        {newQuestions.map((q, i) => (
                                            <div key={i} className="mb-4 border-b pb-4 last:border-0 last:pb-0">
                                                <input type="text" value={q.q} onChange={e => updateQuestion(i, 'q', e.target.value)} className="w-full p-2 border rounded mb-2 text-sm" placeholder={`Soru ${i+1}`} />
                                                <div className="grid grid-cols-2 gap-2 mb-2">
                                                    {q.options.map((opt, oIdx) => (
                                                        <input key={oIdx} type="text" value={opt} onChange={e => updateQuestion(i, 'options', e.target.value, oIdx)} className="w-full p-2 border rounded text-xs" placeholder={`≈ûƒ±k ${oIdx+1}`} />
                                                    ))}
                                                </div>
                                                <select value={q.answer} onChange={e => updateQuestion(i, 'answer', parseInt(e.target.value))} className="w-full p-2 border rounded text-sm bg-white">
                                                    {q.options.map((_, oIdx) => <option key={oIdx} value={oIdx}>Doƒüru Cevap: ≈ûƒ±k {oIdx+1}</option>)}
                                                </select>
                                            </div>
                                        ))}
                                    </div>
                                    <button onClick={handleAddText} className="w-full bg-green-600 text-white p-3 rounded-lg font-bold hover:bg-green-700">Metni Kaydet</button>
                                </div>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                                <h2 className="text-lg font-bold mb-4">Mevcut Metinler ({texts.length})</h2>
                                <div className="space-y-2 max-h-[600px] overflow-y-auto">
                                    {texts.map(t => (
                                        <div key={t.id} className="p-4 border rounded-lg hover:bg-gray-50 flex justify-between items-start group">
                                            <div>
                                                <div className="font-bold text-gray-800">{t.title}</div>
                                                <div className="text-xs text-gray-500 mt-1">Seviye: {t.level} ‚Ä¢ {t.content ? t.content.length : 0} karakter</div>
                                            </div>
                                            <button onClick={() => handleDeleteText(t.id)} className="text-gray-400 hover:text-red-500 p-1"><Trash2 size={18} /></button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'settings' && (
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 max-w-2xl">
                            <h2 className="text-lg font-bold mb-6 flex items-center gap-2 text-gray-700"><Settings size={20}/> Egzersiz Ayarlarƒ±</h2>
                            <div className="mb-6">
                                <label className="block text-sm font-bold text-gray-700 mb-2">Ayarlanacak Egzersizi Se√ßin</label>
                                <select value={selectedExerciseId} onChange={(e) => setSelectedExerciseId(e.target.value)} className="w-full p-3 border rounded-lg bg-gray-50 font-bold text-gray-700">
                                    {EXERCISE_TYPES.map(ex => <option key={ex.id} value={ex.id}>{ex.title} ({ex.category})</option>)}
                                </select>
                            </div>
                            <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 space-y-6">
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">Oyun S√ºresi (Saniye)</label>
                                    <input type="range" min="30" max="300" step="10" value={tempSettings.duration || 60} onChange={(e) => setTempSettings({...tempSettings, duration: parseInt(e.target.value)})} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600" />
                                    <span className="font-mono font-bold bg-indigo-100 text-indigo-700 px-3 py-1 rounded">{tempSettings.duration || 60}s</span>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">Oyun Hƒ±zƒ± / Zorluk (ms)</label>
                                    <input type="number" min="100" max="2000" step="50" value={tempSettings.speed || 1000} onChange={(e) => setTempSettings({...tempSettings, speed: parseInt(e.target.value)})} className="border p-2 rounded w-24 text-center font-bold" />
                                    <span className="text-sm text-gray-500 ml-2">Milisaniye (D√º≈ü√ºk = Daha Hƒ±zlƒ±)</span>
                                </div>
                                <button onClick={handleSaveExerciseSettings} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 shadow-md transition">Ayarlarƒ± Kaydet</button>
                            </div>
                        </div>
                    )}

                    {activeTab === 'pools' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col h-[500px]">
                                <h2 className="text-lg font-bold mb-4 text-indigo-700 flex items-center gap-2"><List size={20}/> Kelime Havuzu</h2>
                                <div className="flex gap-2 mb-4"><input type="text" value={newItem} onChange={(e) => setNewItem(e.target.value)} className="flex-1 p-2 border rounded" placeholder="Yeni Kelime..." onKeyDown={(e) => e.key === 'Enter' && handleAddItem('word')} /><button onClick={() => handleAddItem('word')} className="bg-green-600 text-white px-4 rounded font-bold hover:bg-green-700"><Plus size={20}/></button></div>
                                <div className="flex-1 overflow-y-auto border rounded p-2 bg-gray-50 space-y-1">{wordPool.map((word, idx) => (<div key={idx} className="flex justify-between items-center bg-white p-2 rounded shadow-sm border border-gray-100"><span>{word}</span><button onClick={() => handleDeleteItem('word', idx)} className="text-red-400 hover:text-red-600"><X size={16}/></button></div>))}</div>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col h-[500px]">
                                <h2 className="text-lg font-bold mb-4 text-purple-700 flex items-center gap-2"><List size={20}/> C√ºmle Havuzu</h2>
                                <div className="flex gap-2 mb-4"><input type="text" value={newItem} onChange={(e) => setNewItem(e.target.value)} className="flex-1 p-2 border rounded" placeholder="Yeni C√ºmle..." onKeyDown={(e) => e.key === 'Enter' && handleAddItem('sentence')} /><button onClick={() => handleAddItem('sentence')} className="bg-purple-600 text-white px-4 rounded font-bold hover:bg-purple-700"><Plus size={20}/></button></div>
                                <div className="flex-1 overflow-y-auto border rounded p-2 bg-gray-50 space-y-1">{sentencePool.map((sentence, idx) => (<div key={idx} className="flex justify-between items-center bg-white p-2 rounded shadow-sm border border-gray-100"><span className="text-sm truncate pr-2" title={sentence}>{sentence}</span><button onClick={() => handleDeleteItem('sentence', idx)} className="text-red-400 hover:text-red-600 shrink-0"><X size={16}/></button></div>))}</div>
                            </div>
                        </div>
                    )}
                    
                    {activeTab === 'cloud' && (
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 max-w-2xl">
                            <h2 className="text-lg font-bold mb-6 flex items-center gap-2 text-indigo-700"><Cloud size={20}/> Google Sheets Baƒülantƒ±sƒ±</h2>
                            <div className="space-y-4">
                                <div><label className="block text-sm font-bold text-gray-700 mb-2">Web App URL</label><input type="text" value={scriptUrl} onChange={e => setScriptUrl(e.target.value)} className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 font-mono text-sm" /></div>
                                <button onClick={saveSettings} className="bg-indigo-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-indigo-700 transition w-full">Baƒülantƒ±yƒ± Kaydet ve Yenile</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        const ReadingTest = ({ texts, onComplete, readTextIds }) => {
          const [step, setStep] = useState('select');
          const [selectedText, setSelectedText] = useState(null);
          const [startTime, setStartTime] = useState(null);
          const [endTime, setEndTime] = useState(null);
          const [answers, setAnswers] = useState({});
          const [currentQIndex, setCurrentQIndex] = useState(0);

          const startReading = () => { setStartTime(Date.now()); setStep('read'); };
          const finishReading = () => { setEndTime(Date.now()); setStep('quiz'); setCurrentQIndex(0); };

          const calculateResult = () => {
            const durationMin = (endTime - startTime) / 1000 / 60;
            const wordCount = selectedText.content.trim().split(/\s+/).length;
            const wpm = Math.round(wordCount / durationMin);
            let correct = 0;
            selectedText.questions.forEach((q, i) => { if (answers[i] === q.answer) correct++; });
            const accuracy = (correct / selectedText.questions.length) * 100;
            return { textId: selectedText.id, wpm, accuracy, date: new Date().toLocaleDateString() };
          };

          if (step === 'select') return (
              <div className="bg-white p-8 rounded-xl shadow-sm max-w-4xl mx-auto animate-in">
                <h2 className="text-2xl font-bold mb-6">Bir Metin Se√ßin</h2>
                <div className="grid gap-4 max-h-[600px] overflow-y-auto">
                  {texts.map(text => {
                    const isRead = readTextIds.includes(text.id);
                    return (
                      <button key={text.id} onClick={() => setSelectedText(text)} className={`p-4 border rounded-lg text-left hover:bg-indigo-50 transition flex justify-between items-center ${selectedText?.id === text.id ? 'border-indigo-500 bg-indigo-50 ring-2 ring-indigo-200' : 'border-gray-200'} ${isRead ? 'bg-green-50/50' : ''}`}>
                        <div><div className="font-semibold text-lg flex items-center gap-2">{text.title}{isRead && <span className="text-green-600 bg-green-100 text-xs px-2 py-0.5 rounded-full flex items-center gap-1"><CheckCircle size={12}/> Okundu</span>}</div><div className="text-sm text-gray-500">Seviye: {text.level}</div></div>
                        <div className="text-sm font-medium bg-gray-100 px-3 py-1 rounded-full text-gray-600">{text.content ? text.content.trim().split(/\s+/).length : 0} kelime</div>
                      </button>
                    );
                  })}
                </div>
                <div className="mt-6 flex justify-end"><button disabled={!selectedText} onClick={startReading} className="px-6 py-3 bg-indigo-600 text-white rounded-lg disabled:opacity-50 hover:bg-indigo-700">Okumaya Ba≈üla</button></div>
              </div>
          );

          if (step === 'read') return (
              <div className="bg-white p-8 rounded-xl shadow-sm max-w-4xl mx-auto animate-in">
                <div className="mb-4 flex justify-between items-center border-b pb-4"><div className="flex flex-col"><span className="font-bold text-gray-700">{selectedText.title}</span><span className="text-xs text-gray-500">Okuma Modu</span></div><button onClick={finishReading} className="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 font-bold animate-pulse">Bƒ∞Tƒ∞RDƒ∞M</button></div>
                <div className="prose max-w-none text-2xl leading-loose text-gray-800 font-serif">{selectedText.content}</div>
              </div>
          );

          if (step === 'quiz') {
            const currentQ = selectedText.questions && selectedText.questions[currentQIndex];
            if (!currentQ) return <div className="p-8 text-center text-red-500">Soru y√ºklenirken bir hata olu≈ütu.</div>;
            const isLastQuestion = currentQIndex === selectedText.questions.length - 1;
            return (
              <div className="bg-white p-8 rounded-xl shadow-sm max-w-3xl mx-auto animate-in">
                <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">Anlama Testi</h2><span className="text-sm font-bold bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full">Soru {currentQIndex + 1} / {selectedText.questions.length}</span></div>
                <div className="mb-8"><p className="font-semibold text-lg mb-4">{currentQ.q}</p><div className="space-y-3">{currentQ.options.map((opt, optIdx) => (<label key={optIdx} className={`flex items-center gap-3 p-4 rounded-lg border cursor-pointer transition-all ${answers[currentQIndex] === optIdx ? 'bg-indigo-50 border-indigo-500 ring-1 ring-indigo-500' : 'bg-white border-gray-200 hover:bg-gray-50'}`}><input type="radio" name={`q-${currentQIndex}`} value={optIdx} onChange={() => setAnswers({...answers, [currentQIndex]: optIdx})} checked={answers[currentQIndex] === optIdx} className="w-5 h-5 text-indigo-600" /><span className="text-gray-700">{opt}</span></label>))}</div></div>
                <div className="flex justify-end">{isLastQuestion ? (<button disabled={answers[currentQIndex] === undefined} onClick={() => { const result = calculateResult(); onComplete(result); }} className="px-8 py-3 bg-green-600 text-white rounded-lg disabled:opacity-50 hover:bg-green-700 font-bold flex items-center gap-2">Testi Bitir <CheckCircle size={20}/></button>) : (<button disabled={answers[currentQIndex] === undefined} onClick={() => setCurrentQIndex(prev => prev + 1)} className="px-8 py-3 bg-indigo-600 text-white rounded-lg disabled:opacity-50 hover:bg-indigo-700 font-bold flex items-center gap-2">Sonraki Soru <ArrowRight size={20}/></button>)}</div>
              </div>
            );
          }
          return null;
        };

        const ExerciseMenu = ({ onSelect, stats }) => {
          return (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-in">
              {EXERCISE_TYPES.map(ex => (
                <div key={ex.id} className="bg-white rounded-xl shadow-sm hover:shadow-md transition border border-gray-100 overflow-hidden cursor-pointer group hover:-translate-y-1" onClick={() => onSelect(ex)}>
                  <div className="p-1 h-2 bg-indigo-500 w-0 group-hover:w-full transition-all duration-500"></div>
                  <div className="p-6">
                    <div className="flex justify-between items-start mb-4"><div className="p-3 bg-indigo-50 text-indigo-600 rounded-lg"><Activity size={24} /></div><span className="text-xs font-bold px-2 py-1 bg-gray-100 text-gray-600 rounded-full">{ex.category}</span></div>
                    <h3 className="font-bold text-lg mb-2">{ex.title}</h3>
                    <p className="text-sm text-gray-500">Tƒ±klayƒ±n ve egzersizi ba≈ülatƒ±n.</p>
                    {stats.exerciseStats && stats.exerciseStats[ex.id] && stats.exerciseStats[ex.id].length > 0 && (<div className="mt-4 h-16"><SafeChart data={stats.exerciseStats[ex.id]} color="#10b981" /></div>)}
                  </div>
                </div>
              ))}
            </div>
          );
        };

        const ExerciseRunner = ({ exercise, onClose, onComplete, allTexts, settings, globalSettings, wordPool, sentencePool, userWpm }) => {
          const [score, setScore] = useState(0);
          const [timer, setTimer] = useState(settings.duration || globalSettings.generalDuration || 60); 
          const [isActive, setIsActive] = useState(false);
          const [gameData, setGameData] = useState(null);
          const [inputValue, setInputValue] = useState(""); 
          const [showContent, setShowContent] = useState(false); 
          const [feedback, setFeedback] = useState(null); 
          const [correctAnswer, setCorrectAnswer] = useState("");
          const [history, setHistory] = useState([]); // Track used items to prevent repetition
          
          const [tachiPhase, setTachiPhase] = useState('setup');
          const [tachiWordIndex, setTachiWordIndex] = useState(0);
          const [tachiIsPlaying, setTachiIsPlaying] = useState(false);
          const [tachiSettings, setTachiSettings] = useState({ textId: allTexts[0].id, wpm: settings.speed || globalSettings.tachiSpeed || 300 });

          const [eyeTrackPhase, setEyeTrackPhase] = useState('start'); 
          const [eyeTrackEmoji, setEyeTrackEmoji] = useState(null);
          const [eyeTrackCount, setEyeTrackCount] = useState(0);
          const [eyeTrackCurrentEmoji, setEyeTrackCurrentEmoji] = useState(null);
          const [eyeTrackPos, setEyeTrackPos] = useState({x: 50, y: 50});
          const [eyeTrackSpeed, setEyeTrackSpeed] = useState(settings.speed || globalSettings.eyeTrackSpeed || 1000); 
          const [eyeTrackLevel, setEyeTrackLevel] = useState(1); 

          useEffect(() => {
            let interval;
            if (isActive && timer > 0 && !feedback && exercise.type !== 'tachistoscope_text') { 
              interval = setInterval(() => setTimer(t => t - 1), 1000);
            } else if (timer === 0 && exercise.type !== 'tachistoscope_text') {
              setIsActive(false);
              onComplete(score);
            }
            return () => clearInterval(interval);
          }, [isActive, timer, feedback, exercise.type]);

          const getDurationForWpm = (wordCount) => {
               const effectiveUserWpm = userWpm > 0 ? userWpm : 100; 
               const targetWpm = effectiveUserWpm + 10; 
               const msPerWord = Math.floor(60000 / targetWpm);
               return Math.max(500, wordCount * msPerWord); 
          };

          useEffect(() => {
              let tachiInterval;
              if (tachiIsPlaying && gameData && gameData.words) {
                  const delay = Math.floor(60000 / tachiSettings.wpm);
                  tachiInterval = setInterval(() => {
                      setTachiWordIndex(prev => {
                          if (prev >= gameData.words.length - 1) {
                              setTachiIsPlaying(false);
                              setIsActive(false); 
                              onComplete(score);
                              return prev;
                          }
                          return prev + 1;
                      });
                  }, delay); 
              }
              return () => clearInterval(tachiInterval);
          }, [tachiIsPlaying, gameData, tachiSettings.wpm]);

          useEffect(() => {
              let eyeInterval;
              if (eyeTrackPhase === 'anim') {
                  const roundDuration = generateRandomNumber(10000, 30000); 
                  eyeInterval = setInterval(() => {
                      const isTarget = Math.random() < 0.25; 
                      let current;
                      if (isTarget) { current = eyeTrackEmoji; } 
                      else {
                          let pool = EMOJI_POOL.filter(e => e !== eyeTrackEmoji);
                          current = pool[generateRandomNumber(0, pool.length - 1)];
                      }
                      setEyeTrackCurrentEmoji(current);
                      setEyeTrackPos({ x: generateRandomNumber(10, 90), y: generateRandomNumber(10, 90) });
                      if (current === eyeTrackEmoji) { setEyeTrackCount(prev => prev + 1); }
                  }, eyeTrackSpeed); 

                  const timeout = setTimeout(() => { setEyeTrackPhase('input'); setEyeTrackCurrentEmoji(null); }, roundDuration);
                  return () => { clearInterval(eyeInterval); clearTimeout(timeout); }
              }
          }, [eyeTrackPhase, eyeTrackEmoji, eyeTrackSpeed]);


          const startGame = () => {
            if (exercise.type === 'tachistoscope_text') {
                setTachiPhase('setup');
                return;
            }
            setIsActive(true);
            setScore(0);
            const duration = exercise.type === 'eye_track_count' 
                ? (settings.duration || globalSettings.eyeTrackDuration || 300) 
                : (settings.duration || globalSettings.generalDuration || 60);
            setTimer(duration); 
            setInputValue("");
            setFeedback(null);
            if(exercise.type === 'eye_track_count') {
                setEyeTrackSpeed(settings.speed || globalSettings.eyeTrackSpeed || 1000); 
                setEyeTrackLevel(1);
            }
            generateLevel();
          };

          const startTachistoscope = () => {
              const selectedText = allTexts.find(t => t.id === parseInt(tachiSettings.textId));
              if (!selectedText) return;
              const words = selectedText.content.trim().split(/\s+/);
              setGameData({ title: selectedText.title, words });
              setTachiWordIndex(0);
              setTachiPhase('playing');
              setTachiIsPlaying(true);
              setIsActive(true);
          };

          const getAdaptiveSpeed = (baseSpeed) => {
              if (!userWpm || userWpm < 50) return baseSpeed; 
              const referenceWpm = 200; 
              const factor = Math.min(Math.max(referenceWpm / userWpm, 0.4), 1.5);
              return Math.floor(baseSpeed * factor);
          };
          
          const getUniqueItem = (pool) => {
            const available = pool.filter(i => !history.includes(i));
            if (available.length === 0) {
               const resetItem = pool[Math.floor(Math.random() * pool.length)];
               setHistory([resetItem]);
               return resetItem;
            }
            const newItem = available[Math.floor(Math.random() * available.length)];
            setHistory(prev => [...prev, newItem]);
            return newItem;
          };

          const generateLevel = () => {
            setInputValue("");
            setShowContent(true);
            setFeedback(null);
            setCorrectAnswer("");
            
            const currentWordPool = wordPool && wordPool.length > 0 ? wordPool : DEFAULT_WORD_POOL;
            const currentSentencePool = sentencePool && sentencePool.length > 0 ? sentencePool : DEFAULT_SENTENCE_POOL;

            switch(exercise.type) {
                case 'grid': 
                    const target = currentWordPool[generateRandomNumber(0, currentWordPool.length - 1)];
                    const others = Array.from({length: 15}, () => currentWordPool[generateRandomNumber(0, currentWordPool.length - 1)]);
                    setGameData({ target, grid: shuffleArray([target, ...others]) });
                    break;
                case 'grid_diff': 
                    const uniqueWords = shuffleArray(currentWordPool).slice(0, 16);
                    const normalPairs = uniqueWords.slice(0, 14).map(w => ({ w1: w, w2: w, isTarget: false, id: Math.random(), found: false }));
                    const diffPairs = uniqueWords.slice(14, 16).map(w => ({ w1: w, w2: createTypo(w), isTarget: true, id: Math.random(), found: false }));
                    setGameData({ grid: shuffleArray([...normalPairs, ...diffPairs]), foundCount: 0, totalTargets: 2 });
                    break;
                case 'math_logic': 
                    const isTargetEven = Math.random() > 0.5;
                    const numbers = Array.from({length: 16}, () => ({ val: generateRandomNumber(1000, 9999), id: Math.random(), found: false })).map(n => ({ ...n, isTarget: isTargetEven ? (n.val % 2 === 0) : (n.val % 2 !== 0) }));
                    setGameData({ numbers, targetType: isTargetEven ? '√áift' : 'Tek', totalTargets: numbers.filter(n => n.isTarget).length, foundCount: 0 });
                    break;
                case 'search_num':
                    const targetNum = generateRandomNumber(100, 9999);
                    const randomGrid = Array.from({length: 23}, () => generateRandomNumber(100, 9999));
                    setGameData({ target: targetNum, grid: shuffleArray([targetNum, ...randomGrid]) });
                    break;
                case 'search_letter': 
                    const char1 = ALPHABET[generateRandomNumber(0, ALPHABET.length - 1)];
                    let char2 = ALPHABET[generateRandomNumber(0, ALPHABET.length - 1)];
                    while(char1 === char2) char2 = ALPHABET[generateRandomNumber(0, ALPHABET.length - 1)];
                    const targets = [char1, char2];
                    const targetItems = Array.from({length: 10}, () => targets[generateRandomNumber(0, 1)]);
                    const otherItems = Array.from({length: 30}, () => {
                        let c = ALPHABET[generateRandomNumber(0, ALPHABET.length - 1)];
                        while(targets.includes(c)) c = ALPHABET[generateRandomNumber(0, ALPHABET.length - 1)];
                        return c;
                    });
                    setGameData({ targets, grid: shuffleArray([...targetItems, ...otherItems]).map((char, i) => ({ char, id: i, found: false, isTarget: targets.includes(char) })), foundCount: 0, totalTargets: 10 });
                    break;
                case 'flash_memory': 
                    const rawFlashWord = getUniqueItem(currentWordPool);
                    const flashWord = randomizeCase(rawFlashWord);
                    const duration = getDurationForWpm(1);
                    setGameData({ word: flashWord });
                    setTimeout(() => setShowContent(false), duration);
                    break;
                case 'scramble_word': 
                    const rawScrambleWord = getUniqueItem(currentWordPool);
                    const scrambleWord = randomizeCase(rawScrambleWord);
                    setGameData({ word: scrambleWord, scrambled: shuffleArray(scrambleWord.split('')).join('') });
                    break;
                case 'flash_sentence': 
                    const sentence = getUniqueItem(currentSentencePool);
                    const wCount = sentence.trim().split(/\s+/).length;
                    const sDuration = getDurationForWpm(wCount);
                    setGameData({ sentence });
                    setTimeout(() => setShowContent(false), sDuration);
                    break;
                case 'eye_track_count':
                    const targetEmoji = EMOJI_POOL[generateRandomNumber(0, EMOJI_POOL.length - 1)];
                    setEyeTrackEmoji(targetEmoji);
                    setEyeTrackCount(0);
                    setEyeTrackPhase('start');
                    setGameData({ target: targetEmoji }); 
                    break;
                default:
                    setGameData({ message: "Mod√ºl y√ºkleniyor..." });
            }
          };

          const handleGridClick = (item) => {
            if (exercise.type === 'grid' && item === gameData.target) {
                setScore(s => s + 10);
                generateLevel();
            }
          };
          const handleGridDiffClick = (itemIndex) => {
              const item = gameData.grid[itemIndex];
              if (item.found) return;
              if (item.isTarget) {
                  const newGrid = [...gameData.grid];
                  newGrid[itemIndex] = { ...item, found: true };
                  const newFoundCount = gameData.foundCount + 1;
                  setGameData({ ...gameData, grid: newGrid, foundCount: newFoundCount });
                  setScore(s => s + 10);
                  if (newFoundCount >= gameData.totalTargets) setTimeout(() => generateLevel(), 300);
              } else {
                  setScore(s => Math.max(0, s - 5));
              }
          };
          const handleLetterClick = (index) => {
              const item = gameData.grid[index];
              if (item.found) return;
              if (item.isTarget) {
                  const newGrid = [...gameData.grid];
                  newGrid[index] = { ...item, found: true };
                  const newFoundCount = gameData.foundCount + 1;
                  setGameData({ ...gameData, grid: newGrid, foundCount: newFoundCount });
                  setScore(s => s + 5);
                  if (newFoundCount >= gameData.totalTargets) setTimeout(() => generateLevel(), 300);
              } else {
                  setScore(s => Math.max(0, s - 2));
              }
          };
          const handleMathGridClick = (index) => {
              const item = gameData.numbers[index];
              if (item.found) return;
              if (item.isTarget) {
                  const newNumbers = [...gameData.numbers];
                  newNumbers[index] = { ...item, found: true };
                  const newFoundCount = gameData.foundCount + 1;
                  setGameData({ ...gameData, numbers: newNumbers, foundCount: newFoundCount });
                  setScore(s => s + 5);
                  if (newFoundCount >= gameData.totalTargets) setTimeout(() => generateLevel(), 300);
              } else {
                  setScore(s => Math.max(0, s - 2));
              }
          };
          const handleSearchNumClick = (val) => {
              if (val === gameData.target) {
                  setScore(s => s + 15);
                  generateLevel();
              } else {
                  setScore(s => Math.max(0, s - 5));
              }
          };
          const checkEyeTrackInput = () => {
              const userGuess = parseInt(inputValue);
              if (userGuess === eyeTrackCount) {
                  setFeedback('correct');
                  setScore(s => s + 50);
                  setEyeTrackSpeed(prev => Math.max(300, prev - 100)); 
                  setEyeTrackLevel(prev => prev + 1);
              } else {
                  setFeedback('incorrect');
                  setCorrectAnswer(eyeTrackCount.toString());
                  setEyeTrackSpeed(prev => Math.min(2000, prev + 100)); 
              }
              setEyeTrackPhase('result');
              setTimeout(() => { generateLevel(); }, 3000);
          };
          const checkTextInput = () => {
              if (feedback) return;
              const input = inputValue.toLocaleLowerCase('tr').trim();
              let isCorrect = false;
              let correctText = "";
              if (exercise.type === 'flash_memory' || exercise.type === 'scramble_word') {
                  correctText = gameData.word;
                  const target = gameData.word.toLocaleLowerCase('tr');
                  if (input === target) isCorrect = true;
              } else if (exercise.type === 'flash_sentence') {
                  correctText = gameData.sentence;
                  const targetWords = gameData.sentence.toLocaleLowerCase('tr').replace(/[.,!?;:]/g, '').split(/\s+/);
                  const inputWords = input.replace(/[.,!?;:]/g, '').split(/\s+/);
                  let correctWordCount = 0;
                  const inputWordsSet = new Set(inputWords);
                  targetWords.forEach(w => { if (inputWordsSet.has(w)) correctWordCount++; });
                  setScore(s => s + (correctWordCount * 10));
                  if (correctWordCount === targetWords.length) isCorrect = true;
                  else isCorrect = false;
              }
              setFeedback(isCorrect ? 'correct' : 'incorrect');
              setCorrectAnswer(correctText);
              if (isCorrect) {
                  if (exercise.type !== 'flash_sentence') setScore(s => s + 20); 
                  setTimeout(() => { generateLevel(); }, 1000);
              } else {
                  setTimeout(() => { generateLevel(); }, 3000);
              }
          };

          return (
            <div className="bg-white p-6 rounded-xl shadow-lg border border-indigo-100 max-w-4xl mx-auto min-h-[600px] flex flex-col animate-in">
              <div className="flex justify-between items-center mb-6 border-b pb-4">
                <div>
                   <h2 className="text-2xl font-bold">{exercise.title}</h2>
                   <p className="text-gray-500">{exercise.category}</p>
                </div>
                <div className="flex items-center gap-6">
                    <div className="text-center">
                        <p className="text-xs text-gray-400">Puan</p>
                        <p className="text-2xl font-bold text-indigo-600">{score}</p>
                    </div>
                    {exercise.type !== 'tachistoscope_text' && (<div className="text-center w-16"><p className="text-xs text-gray-400">S√ºre</p><p className={`text-2xl font-bold ${timer < 10 ? 'text-red-500' : 'text-gray-700'}`}>{timer}</p></div>)}
                    <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full"><X /></button>
                </div>
              </div>
              <div className="flex-1 flex flex-col justify-center">
                {!isActive && exercise.type !== 'tachistoscope_text' ? (
                    <div className="text-center">
                        <div className="mb-6 bg-indigo-50 inline-block p-6 rounded-full text-indigo-600"><Zap size={48} /></div>
                        <h3 className="text-xl font-bold mb-2">Hazƒ±r mƒ±sƒ±n?</h3>
                        <p className="text-gray-500 mb-6">Odaklan ve m√ºmk√ºn olan en y√ºksek puanƒ± yap.</p>
                        {userWpm > 0 && <p className="text-xs text-green-600 mt-2 font-bold bg-green-100 px-2 py-1 rounded inline-block">Hƒ±z: {userWpm} WPM'ye g√∂re optimize edildi (+10 bonus)</p>}
                        <button onClick={startGame} className="px-8 py-3 bg-indigo-600 text-white rounded-full text-lg font-semibold hover:bg-indigo-700 hover:scale-105 transition transform shadow-lg mt-4">BA≈ûLAT</button>
                    </div>
                ) : (renderGameArea())}
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
